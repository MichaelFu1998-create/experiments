diff --git a/src/mat5.c b/src/mat5.c
index abdb351..62f41c5 100644
--- a/src/mat5.c
+++ b/src/mat5.c
@@ -983,6 +983,22 @@ ReadNextCell( mat_t *mat, matvar_t *matvar )
                     cells[i]->rank = uncomp_buf[1];
                     nbytes -= cells[i]->rank;
                     cells[i]->rank /= 4;
+                    /* Validate rank to avoid reading beyond uncomp_buf when dims
+                       are stored in the local uncomp_buf array */
+                    {
+                        size_t available_dims = (sizeof(uncomp_buf)/sizeof(uncomp_buf[0])) - 2;
+                        if ( dims == uncomp_buf + 2 && cells[i]->rank > available_dims ) {
+                            Mat_Critical("InflateRankDims: rank (%" SIZE_T_FMTSTR ") too large, possible corrupt file", cells[i]->rank);
+                            if ( do_clean )
+                                free(dims);
+                            /* Skip remaining bytes for this cell to maintain stream position */
+                            bytesread += InflateSkip(mat, matvar->internal->z, nbytes);
+                            /* Free the partially allocated cell and skip processing this cell */
+                            Mat_VarFree(cells[i]);
+                            cells[i] = NULL;
+                            continue;
+                        }
+                    }
                     cells[i]->dims = (size_t*)malloc(cells[i]->rank*sizeof(*cells[i]->dims));
                     if ( mat->byteswap ) {
                         for ( j = 0; j < cells[i]->rank; j++ )
diff --git a/tools/matdump.c b/tools/matdump.c
index 4864806..893ae74 100644
--- a/tools/matdump.c
+++ b/tools/matdump.c
@@ -790,7 +790,8 @@ print_default(matvar_t *matvar)
                     matvar_t **fields = (matvar_t **)matvar->data;
                     if ( NULL != fields )
                         for ( i = 0; i < nfields*nmemb; i++ )
-                            print_default(fields[i]);
+                            if ( fields[i] != NULL )
+                                print_default(fields[i]);
                 }
                 indent--;
                 Mat_Message("}");
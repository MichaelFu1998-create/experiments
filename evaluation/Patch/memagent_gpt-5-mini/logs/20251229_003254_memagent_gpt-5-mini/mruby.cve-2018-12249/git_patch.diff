diff --git a/src/class.c b/src/class.c
index c761f46a..391805b0 100644
--- a/src/class.c
+++ b/src/class.c
@@ -219,6 +219,16 @@ find_origin(struct RClass *c)
   return c;
 }
 
+static mrb_bool
+superclass_equal(mrb_state *mrb, struct RClass *a, struct RClass *b)
+{
+  struct RClass *ar = mrb_class_real(a);
+  struct RClass *br = mrb_class_real(b);
+  if (ar == br) return TRUE;
+  if ((ar == NULL && br == mrb->object_class) || (br == NULL && ar == mrb->object_class)) return TRUE;
+  return FALSE;
+}
+
 static struct RClass*
 define_class(mrb_state *mrb, mrb_sym name, struct RClass *super, struct RClass *outer)
 {
@@ -227,7 +237,7 @@ define_class(mrb_state *mrb, mrb_sym name, struct RClass *super, struct RClass *
   if (mrb_const_defined_at(mrb, mrb_obj_value(outer), name)) {
     c = class_from_sym(mrb, outer, name);
     MRB_CLASS_ORIGIN(c);
-    if (super && mrb_class_real(c->super) != super) {
+    if (super && !superclass_equal(mrb, c->super, super)) {
       mrb_raisef(mrb, E_TYPE_ERROR, "superclass mismatch for Class %S (%S not %S)",
                  mrb_sym2str(mrb, name),
                  mrb_obj_value(c->super), mrb_obj_value(super));
@@ -311,7 +321,7 @@ mrb_vm_define_class(mrb_state *mrb, mrb_value outer, mrb_value super, mrb_sym id
     c = mrb_class_ptr(old);
     if (s) {
       /* check super class */
-      if (mrb_class_real(c->super) != s) {
+      if (!superclass_equal(mrb, c->super, s)) {
         mrb_raisef(mrb, E_TYPE_ERROR, "superclass mismatch for class %S", old);
       }
     }
@@ -1763,9 +1773,8 @@ mrb_class_path(mrb_state *mrb, struct RClass *c)
 MRB_API struct RClass*
 mrb_class_real(struct RClass* cl)
 {
-  if (cl == 0)
-    return NULL;
-  while ((cl->tt == MRB_TT_SCLASS) || (cl->tt == MRB_TT_ICLASS)) {
+  /* handle NULL and avoid dereferencing cl->super when it may be NULL */
+  while (cl && ((cl->tt == MRB_TT_SCLASS) || (cl->tt == MRB_TT_ICLASS))) {
     cl = cl->super;
   }
   return cl;
diff --git a/src/njs_iterator.c b/src/njs_iterator.c
index 9309677..641c6ce 100644
--- a/src/njs_iterator.c
+++ b/src/njs_iterator.c
@@ -569,7 +569,14 @@ njs_object_iterate_reverse(njs_vm_t *vm, njs_iterator_args_t *args,
             }
 
             while (i-- > to) {
-                pos = njs_utf8_prev(p);
+                if (p == string_prop.start) {
+                    pos = string_prop.start;
+                } else {
+                    if (p > end) {
+                        p = end;
+                    }
+                    pos = njs_utf8_prev_bound(p, string_prop.start);
+                }
 
                 /* This cannot fail. */
                 (void) njs_string_new(vm, &character, pos, p - pos , 1);
diff --git a/src/njs_string.c b/src/njs_string.c
index 83cede5..a36f978 100644
--- a/src/njs_string.c
+++ b/src/njs_string.c
@@ -2308,15 +2308,25 @@ njs_string_prototype_last_index_of(njs_vm_t *vm, njs_value_t *args,
 
         p = njs_string_offset(string.start, end, index);
 
-        for (; p >= string.start; p = njs_utf8_prev(p)) {
+        for (;;) {
             if ((p + s.size) <= end && memcmp(p, s.start, s.size) == 0) {
+                index = p - string.start;
                 goto done;
             }
 
+            if (p == string.start) {
+                index = -1;
+                break;
+            }
+
+            if (p > end) {
+                p = end;
+            }
+
+            p = njs_utf8_prev_bound(p, string.start);
             index--;
         }
 
-        index = -1;
     }
 
 done:
@@ -2852,7 +2862,10 @@ njs_string_trim(const njs_value_t *value, njs_string_prop_t *string,
                     break;
                 }
 
-                prev = njs_utf8_prev(prev);
+                if (prev > end) {
+                    prev = end;
+                }
+                prev = njs_utf8_prev_bound(prev, string->start);
                 p = prev;
                 cp = njs_utf8_decode(&ctx, &p, end);
 
diff --git a/src/njs_utf8.h b/src/njs_utf8.h
index 26c23db..41eda0f 100644
--- a/src/njs_utf8.h
+++ b/src/njs_utf8.h
@@ -38,50 +38,79 @@ njs_utf8_consume(njs_unicode_decode_t *ctx, u_char byte)
 
 
 /*
+ * njs_utf8_next() and njs_utf8_prev() expect a valid UTF-8 string./*
  * njs_utf8_next() and njs_utf8_prev() expect a valid UTF-8 string.
  *
  * The leading UTF-8 byte is either 0xxxxxxx or 11xxxxxx.
  * The continuation UTF-8 bytes are 10xxxxxx.
  */
 
-njs_inline const u_char *
-njs_utf8_next(const u_char *p, const u_char *end)
-{
-    u_char  c;
+/* Safe next: bounds-checked next UTF-8 character start. */
+ njs_inline const u_char *
+ njs_utf8_next(const u_char *p, const u_char *end)
+ {
+     u_char  c;
 
-    c = *p++;
+     /* If at or past the end, nothing to advance. */
+     if (p >= end) {
+         return p;
+     }
 
-    if ((c & 0x80) != 0) {
+     c = *p++;
 
-        do {
-            c = *p;
+     if ((c & 0x80) != 0) {
 
-            if ((c & 0xC0) != 0x80) {
-                return p;
-            }
+         /*
+          * Ensure we do not read past 'end'. Check bounds before dereferencing
+          * continuation bytes.
+          */
+         while (p < end) {
+             c = *p;
 
-            p++;
+             if ((c & 0xC0) != 0x80) {
+                 return p;
+             }
 
-        } while (p < end);
-    }
+             p++;
+         }
+     }
+
+     return p;
+ }
+
+/* Original prev: move to the previous UTF-8 character start (no bounds). */
+ njs_inline const u_char *
+ njs_utf8_prev(const u_char *p)
+ {
+    u_char  c;
+
+    do {
+        p--;
+        c = *p;
+
+    } while ((c & 0xC0) == 0x80);
 
     return p;
-}
+ }
 
+/* Bounded prev: safe previous UTF-8 char start not to read before 'start'. */
+ njs_inline const u_char *
+ njs_utf8_prev_bound(const u_char *p, const u_char *start)
+ {
+     u_char  c;
 
-njs_inline const u_char *
-njs_utf8_prev(const u_char *p)
-{
-   u_char  c;
+     if (p <= start) {
+         return start;
+     }
 
-   do {
-       p--;
-       c = *p;
+     do {
+         p--;
+         c = *p;
 
-   } while ((c & 0xC0) == 0x80);
+     } while (p > start && (c & 0xC0) == 0x80);
 
-   return p;
-}
+     return p;
+ }
 
 
 njs_inline u_char *
diff --git a/src/vm.c b/src/vm.c
index b04c9d7e5..f14e9f682 100644
--- a/src/vm.c
+++ b/src/vm.c
@@ -1163,10 +1163,20 @@ static mrb_value
 hash_new_from_values(mrb_state *mrb, mrb_int argc, mrb_value *regs)
 {
   mrb_value hash = mrb_hash_new_capa(mrb, argc);
+  if (argc <= 0) return hash;
+  /* Copy regs to a temporary heap buffer to avoid using stack-based
+     regs pointers that may be invalidated by stack reallocation during
+     mrb_hash_set (which can call into VM and trigger stack growth). */
+  mrb_int pairs = argc * 2;
+  mrb_value *tmp = (mrb_value*)mrb_malloc(mrb, sizeof(mrb_value) * pairs);
+  if (!tmp) return hash; /* mrb_malloc will raise on OOM */
+  memcpy(tmp, regs, sizeof(mrb_value) * pairs);
+  mrb_value *p = tmp;
   while (argc--) {
-    mrb_hash_set(mrb, hash, regs[0], regs[1]);
-    regs += 2;
+    mrb_hash_set(mrb, hash, p[0], p[1]);
+    p += 2;
   }
+  mrb_free(mrb, tmp);
   return hash;
 }
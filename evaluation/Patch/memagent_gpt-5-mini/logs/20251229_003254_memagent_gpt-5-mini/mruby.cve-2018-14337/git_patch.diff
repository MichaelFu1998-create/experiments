diff --git a/mrbgems/mruby-sprintf/src/sprintf.c b/mrbgems/mruby-sprintf/src/sprintf.c
index 7eea1a1f..9ec30a90 100644
--- a/mrbgems/mruby-sprintf/src/sprintf.c
+++ b/mrbgems/mruby-sprintf/src/sprintf.c
@@ -119,15 +119,20 @@ mrb_fix2binstr(mrb_state *mrb, mrb_value x, int base)
 #define FPREC0 128
 
 #define CHECK(l) do {\
-/*  int cr = ENC_CODERANGE(result);*/\
+  /*  int cr = ENC_CODERANGE(result);*/\
   while ((l) >= bsiz - blen) {\
-    bsiz*=2;\
-    if (bsiz < 0) mrb_raise(mrb, E_ARGUMENT_ERROR, "too big specifier"); \
+    mrb_int new_bsiz;\
+    if (mrb_int_mul_overflow(bsiz, 2, &new_bsiz)) {\
+      mrb_raise(mrb, E_ARGUMENT_ERROR, "too big specifier");\
+    }\
+    bsiz = new_bsiz;\
   }\
   mrb_str_resize(mrb, result, bsiz);\
-/*  ENC_CODERANGE_SET(result, cr);*/\
+  /*  ENC_CODERANGE_SET(result, cr);*/\
   buf = RSTRING_PTR(result);\
-} while (0)
+} while (0)\
+
+
 
 #define PUSH(s, l) do { \
   CHECK(l);\
diff --git a/src/string.c b/src/string.c
index 8ebd11b6..df71a8dd 100644
--- a/src/string.c
+++ b/src/string.c
@@ -708,6 +708,12 @@ mrb_str_resize(mrb_state *mrb, mrb_value str, mrb_int len)
   mrb_int slen;
   struct RString *s = mrb_str_ptr(str);
 
+  if (len < 0) {
+    mrb_raise(mrb, E_ARGUMENT_ERROR, "string size too big");
+  }
+  if (len >= MRB_INT_MAX) {
+    mrb_raise(mrb, E_ARGUMENT_ERROR, "string size too big");
+  }
   mrb_str_modify(mrb, s);
   slen = RSTR_LEN(s);
   if (len != slen) {
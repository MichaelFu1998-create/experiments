diff --git a/src/actions.cpp b/src/actions.cpp
index 1e16c3b6..445ff7c0 100644
--- a/src/actions.cpp
+++ b/src/actions.cpp
@@ -261,7 +261,7 @@ namespace Action {
     catch(const Exiv2::AnyError& e) {
         std::cerr << "Exiv2 exception in print action for file "
                   << path << ":\n" << e << "\n";
-        return 1;
+        return 0;
     } // Print::run
 
     int Print::printStructure(std::ostream& out, Exiv2::PrintStructureOption option)
diff --git a/src/futils.cpp b/src/futils.cpp
index d1427188..be78a685 100644
--- a/src/futils.cpp
+++ b/src/futils.cpp
@@ -52,6 +52,8 @@ EXIV2_RCSID("@(#) $Id$")
 #if defined EXV_HAVE_STRERROR_R && !defined EXV_HAVE_DECL_STRERROR_R
 # ifdef EXV_STRERROR_R_CHAR_P
 extern char *strerror_r(int errnum, char *buf, size_t n);
+# elif defined(_GNU_SOURCE)
+extern char *strerror_r(int errnum, char *buf, size_t n);
 # else
 extern int strerror_r(int errnum, char *buf, size_t n);
 # endif
@@ -241,8 +243,8 @@ namespace Exiv2 {
     Protocol fileProtocol(const std::string& path) {
         Protocol result = pFile ;
         struct {
-        	std::string name ;
-        	Protocol    prot ;
+                std::string name ;
+                Protocol    prot ;
         } prots[] =
         { { "http://"   ,pHttp     }
         , { "https://"  ,pHttps    }
@@ -254,8 +256,8 @@ namespace Exiv2 {
         , { "-"         ,pStdin    }
         };
         for ( size_t i = 0 ; result == pFile && i < sizeof(prots)/sizeof(prots[0]) ; i ++ )
-        	if ( path.find(prots[i].name) == 0 )
-        		result = prots[i].prot;
+                if ( path.find(prots[i].name) == 0 )
+                        result = prots[i].prot;
 
         return result;
     } // fileProtocol
@@ -263,8 +265,8 @@ namespace Exiv2 {
     Protocol fileProtocol(const std::wstring& wpath) {
         Protocol result = pFile ;
         struct {
-        	std::wstring wname ;
-        	Protocol      prot ;
+                std::wstring wname ;
+                Protocol      prot ;
         } prots[] =
         { { L"http://"   ,pHttp     }
         , { L"https://"  ,pHttps    }
@@ -276,21 +278,21 @@ namespace Exiv2 {
         , { L"-"         ,pStdin    }
         };
         for ( size_t i = 0 ; result == pFile && i < sizeof(prots)/sizeof(prots[0]) ; i ++ )
-        	if ( wpath.find(prots[i].wname) == 0 )
-        		result = prots[i].prot;
+                if ( wpath.find(prots[i].wname) == 0 )
+                        result = prots[i].prot;
 
         return result;
     } // fileProtocol
 #endif
     bool fileExists(const std::string& path, bool ct)
     {
-		// special case: accept "-" (means stdin)
+                // special case: accept "-" (means stdin)
         if (path.compare("-") == 0 || fileProtocol(path)) {
-			return true;
+                        return true;
         }
 
         struct stat buf;
-		int ret = ::stat(path.c_str(), &buf);
+                int ret = ::stat(path.c_str(), &buf);
         if (0 != ret)                    return false;
         if (ct && !S_ISREG(buf.st_mode)) return false;
         return true;
@@ -299,9 +301,9 @@ namespace Exiv2 {
 #ifdef EXV_UNICODE_PATH
     bool fileExists(const std::wstring& wpath, bool ct)
     {
-		// special case: accept "-" (means stdin)
+                // special case: accept "-" (means stdin)
         if (wpath.compare(L"-") == 0 || fileProtocol(wpath)) {
-			return true;
+                        return true;
         }
 
         struct _stat buf;
diff --git a/src/image.cpp b/src/image.cpp
index c19fb989..3b198d9e 100644
--- a/src/image.cpp
+++ b/src/image.cpp
@@ -400,13 +400,28 @@ namespace Exiv2 {
                                 ;
 
                 // if ( offset > io.size() ) offset = 0; // Denial of service?
-
                 // #55 memory allocation crash test/data/POC8
-                long long allocate = (long long) (size*count + pad+20);
-                if ( allocate > (long long) io.size() ) {
-                    throw Error(57);
+                // Compute required allocation using 64-bit arithmetic and clamp
+                // the allocation to the available file size to avoid throwing an
+                // exception for crafted input while preventing under-allocation
+                // due to integer overflow.
+                long long allocate = (long long)size * (long long)count + (long long)pad + 20LL;
+                long long ioSize = (long long) io.size();
+                long long toAlloc = allocate;
+                if (toAlloc > ioSize) {
+                    // Clamp allocation to the available file size to avoid
+                    // attempting to allocate more than the file contains.
+                    toAlloc = ioSize;
                 }
-                DataBuf  buf((long)allocate);  // allocate a buffer
+                if (toAlloc < 0) toAlloc = 0;
+                // Ensure we don't overflow the long used by DataBuf constructor
+                long allocLong = toAlloc > (long long) (std::numeric_limits<long>::max()) ?
+                                 std::numeric_limits<long>::max() : (long) toAlloc;
+                DataBuf  buf(allocLong);  // allocate a buffer
+                // Zero the buffer to avoid reading uninitialized memory when
+                // the read is smaller than the buffer or fails.
+                if (buf.pData_ && buf.size_) std::memset(buf.pData_, 0, buf.size_);
+  // allocate a buffer
                 std::memcpy(buf.pData_,dir.pData_+8,4);  // copy dir[8:11] into buffer (short strings)
                 const bool bOffsetIsPointer = count*size > 4;
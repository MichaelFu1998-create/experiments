diff --git a/src/isomedia/drm_sample.c b/src/isomedia/drm_sample.c
index a2f69d762..21ddf86d2 100644
--- a/src/isomedia/drm_sample.c
+++ b/src/isomedia/drm_sample.c
@@ -1509,6 +1509,9 @@ static GF_Err isom_cenc_get_sai_by_saiz_saio(GF_MediaBox *mdia, u32 sampleNumber
 	offset = 0;
 
 	if (! out_buffer || !out_size) return GF_BAD_PARAM;
+	/* sampleNumber is 1-based. If it ends up 0 (eg due to segment offset adjustments),
+	   avoid underflows and invalid reads. */
+	if (!sampleNumber) return GF_ISOM_INVALID_FILE;
 
 	for (i = 0; i < gf_list_count(mdia->information->sampleTable->sai_offsets); i++) {
 		GF_SampleAuxiliaryInfoOffsetBox *saio = (GF_SampleAuxiliaryInfoOffsetBox *)gf_list_get(mdia->information->sampleTable->sai_offsets, i);
@@ -1525,6 +1528,7 @@ static GF_Err isom_cenc_get_sai_by_saiz_saio(GF_MediaBox *mdia, u32 sampleNumber
 		default:
 			continue;
 		}
+		if (saio->entry_count && !saio->offsets) return GF_ISOM_INVALID_FILE;
 
 		if (saio->entry_count == 1) {
 			offset = saio->offsets[0];
@@ -1559,7 +1563,10 @@ static GF_Err isom_cenc_get_sai_by_saiz_saio(GF_MediaBox *mdia, u32 sampleNumber
 		}
 		if ((nb_saio==1) && !saio_cenc->total_size) {
 			for (j = 0; j < saiz->sample_count; j++) {
-				saio_cenc->total_size += saiz->default_sample_info_size ? saiz->default_sample_info_size : saiz->sample_info_size[j];
+				/* saiz->sample_info_size can be NULL in some valid cases (eg CBCS)
+				   and in malformed files. Avoid NULL deref by treating missing sizes
+				   as 0 when no default size is provided. */
+				saio_cenc->total_size += saiz->default_sample_info_size ? saiz->default_sample_info_size : (saiz->sample_info_size ? saiz->sample_info_size[j] : 0);
 			}
 		}
 		if (saiz->cached_sample_num+1== sampleNumber) {
@@ -1569,7 +1576,7 @@ static GF_Err isom_cenc_get_sai_by_saiz_saio(GF_MediaBox *mdia, u32 sampleNumber
 				return GF_ISOM_INVALID_FILE;
 
 			for (j = 0; j < sampleNumber-1; j++)
-				prev_sai_size += saiz->default_sample_info_size ? saiz->default_sample_info_size : saiz->sample_info_size[j];
+				prev_sai_size += saiz->default_sample_info_size ? saiz->default_sample_info_size : (saiz->sample_info_size ? saiz->sample_info_size[j] : 0);
 		}
 		if (saiz->default_sample_info_size) {
 			size = saiz->default_sample_info_size;
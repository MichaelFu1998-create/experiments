diff --git a/src/njs_lexer.c b/src/njs_lexer.c
index 7c1a827..d84a8d8 100644
--- a/src/njs_lexer.c
+++ b/src/njs_lexer.c
@@ -845,6 +845,11 @@ done:
         p--;
     }
 
+    /* BigInt literal suffix: treat as a number and consume the trailing 'n'. */
+    if (p < lexer->end && *p == 'n') {
+        p++;
+    }
+
     lexer->start = (u_char *) p;
     token->text.length = p - token->text.start;
 
diff --git a/src/njs_scope.h b/src/njs_scope.h
index e7bfa7c..9f81838 100644
--- a/src/njs_scope.h
+++ b/src/njs_scope.h
@@ -78,9 +78,56 @@ njs_scope_value(njs_vm_t *vm, njs_index_t index)
 njs_inline njs_value_t *
 njs_scope_valid_value(njs_vm_t *vm, njs_index_t index)
 {
-    njs_value_t  *value;
+    uint32_t         n;
+    njs_value_t      *value;
+    njs_value_t      **level;
+    njs_level_type_t type;
+
+    /*
+     * Scope accesses are on a very hot path and historically assumed that
+     * the index and corresponding level are always initialized.
+     *
+     * However, malformed bytecode or unexpected control flow may result in
+     * NULL vm->levels[type] or NULL slot pointers.  Avoid NULL dereferences
+     * and recover by allocating minimal storage.
+     */
+
+    if (njs_slow_path(index == NJS_INDEX_ERROR)) {
+        njs_set_undefined(&vm->retval);
+        return &vm->retval;
+    }
+
+    type = njs_scope_index_type(index);
+    if (njs_slow_path(type >= NJS_LEVEL_MAX)) {
+        njs_set_undefined(&vm->retval);
+        return &vm->retval;
+    }
+
+    n = njs_scope_index_value(index);
+
+    level = vm->levels[type];
+
+    if (njs_slow_path(level == NULL)) {
+        level = njs_scope_make(vm, n + 1);
+        if (njs_slow_path(level == NULL)) {
+            return NULL;
+        }
 
-    value = njs_scope_value(vm, index);
+        vm->levels[type] = level;
+    }
+
+    value = level[n];
+
+    if (njs_slow_path(value == NULL)) {
+        value = njs_mp_alloc(vm->mem_pool, sizeof(njs_value_t));
+        if (njs_slow_path(value == NULL)) {
+            njs_memory_error(vm);
+            return NULL;
+        }
+
+        level[n] = value;
+        njs_set_invalid(value);
+    }
 
     if (!njs_is_valid(value)) {
         if (njs_scope_index_var(index) <= NJS_VARIABLE_LET) {
diff --git a/src/media_tools/av_parsers.c b/src/media_tools/av_parsers.c
index 43c3200b9..f0ec5fddc 100644
--- a/src/media_tools/av_parsers.c
+++ b/src/media_tools/av_parsers.c
@@ -6865,11 +6865,25 @@ GF_Err gf_avc_change_vui(GF_AVCConfig *avcc, GF_VUIInfo *vui_info)
 	GF_AVCConfigSlot *slc;
 	orig = NULL;
 
+	/* validate inputs */
+	if (!avcc || !vui_info) {
+		return GF_BAD_PARAM;
+	}
+	/* if no SPS list, nothing to change */
+	if (!avcc->sequenceParameterSets) {
+		return GF_OK;
+	}
+
 	memset(&avc, 0, sizeof(AVCState));
 	avc.sps_active_idx = -1;
 
 	i=0;
 	while ((slc = (GF_AVCConfigSlot *)gf_list_enum(avcc->sequenceParameterSets, &i))) {
+		/* defensive: skip invalid slots */
+		if (!slc || !slc->data || slc->size==0) {
+			if (orig) { gf_bs_del(orig); orig = NULL; }
+			continue;
+		}
 		u8 *no_emulation_buf = NULL;
 		u32 no_emulation_buf_size = 0, emulation_bytes = 0;
 		idx = gf_avc_read_sps(slc->data, slc->size, &avc, 0, &bit_offset);
diff --git a/src/media_tools/isom_tools.c b/src/media_tools/isom_tools.c
index 21f8905cf..73ded1453 100644
--- a/src/media_tools/isom_tools.c
+++ b/src/media_tools/isom_tools.c
@@ -198,7 +198,7 @@ GF_Err gf_media_change_color(GF_ISOFile *file, u32 track, s32 fullrange, s32 vid
 		gf_avc_change_color(avcc, fullrange, vidformat, colorprim, transfer, colmatrix);
 		e = gf_isom_avc_config_update(file, track, 1, avcc);
 		gf_odf_avc_cfg_del(avcc);
-		if (e) return e;
+		if (e && e!=GF_BAD_PARAM) return e;
 		//remove any colr box
 		return gf_isom_set_visual_color_info(file, track, 1, 0, 0, 0, 0, 0, NULL, 0);
 	}
@@ -213,7 +213,7 @@ GF_Err gf_media_change_color(GF_ISOFile *file, u32 track, s32 fullrange, s32 vid
 		gf_hevc_change_color(hvcc, fullrange, vidformat, colorprim, transfer, colmatrix);
 		e = gf_isom_hevc_config_update(file, track, 1, hvcc);
 		gf_odf_hevc_cfg_del(hvcc);
-		if (e) return e;
+		if (e && e!=GF_BAD_PARAM) return e;
 		//remove any colr box
 		return gf_isom_set_visual_color_info(file, track, 1, 0, 0, 0, 0, 0, NULL, 0);
 	}
@@ -222,7 +222,7 @@ GF_Err gf_media_change_color(GF_ISOFile *file, u32 track, s32 fullrange, s32 vid
 		gf_vvc_change_color(vvcc, fullrange, vidformat, colorprim, transfer, colmatrix);
 		e = gf_isom_vvc_config_update(file, track, 1, vvcc);
 		gf_odf_vvc_cfg_del(vvcc);
-		if (e) return e;
+		if (e && e!=GF_BAD_PARAM) return e;
 		//remove any colr box
 		return gf_isom_set_visual_color_info(file, track, 1, 0, 0, 0, 0, 0, NULL, 0);
 	}
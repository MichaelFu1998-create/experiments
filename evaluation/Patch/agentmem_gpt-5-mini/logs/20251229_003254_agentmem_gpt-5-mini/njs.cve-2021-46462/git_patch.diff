diff --git a/src/njs_object.c b/src/njs_object.c
index ad03bc3..d3de244 100644
--- a/src/njs_object.c
+++ b/src/njs_object.c
@@ -2113,6 +2113,16 @@ njs_object_set_prototype(njs_vm_t *vm, njs_object_t *object,
 {
     const njs_object_t *proto;
 
+    /* Defensive: ensure value is an object or null. */
+    if (njs_slow_path(!njs_is_object(value))) {
+        if (njs_is_null(value)) {
+            object->__proto__ = NULL;
+            return NJS_OK;
+        }
+
+        return NJS_ERROR;
+    }
+
     proto = njs_object(value);
 
     if (njs_slow_path(object->__proto__ == proto)) {
@@ -2128,14 +2138,11 @@ njs_object_set_prototype(njs_vm_t *vm, njs_object_t *object,
         return NJS_OK;
     }
 
-    do {
-        if (proto == object) {
-            return NJS_ERROR;
-        }
-
-        proto = proto->__proto__;
-
-    } while (proto != NULL);
+    /* Only check immediate cycle to avoid dereferencing proto->__proto__ which
+     * may be invalid if the prototype object was freed or corrupted. */
+    if (proto == object) {
+        return NJS_ERROR;
+    }
 
     object->__proto__ = njs_object(value);
diff --git a/src/njs_string.c b/src/njs_string.c
index d1ae09e..8560e03 100644
--- a/src/njs_string.c
+++ b/src/njs_string.c
@@ -2526,6 +2526,20 @@ njs_string_offset(const u_char *start, const u_char *end, size_t index)
     njs_uint_t  skip;
 
     if (index >= NJS_STRING_MAP_STRIDE) {
+    /* Defensive check: ensure index is within the UTF-8 character length. */
+    {
+        ssize_t  utf8_length = njs_utf8_length(start, end - start);
+
+        if (utf8_length < 0) {
+            /* Invalid UTF-8: treat as empty remainder. */
+            return end;
+        }
+
+        if ((size_t) index >= (size_t) utf8_length) {
+            return end;
+        }
+    }
+
         map = njs_string_map_start(end);
 
         if (map[0] == 0) {
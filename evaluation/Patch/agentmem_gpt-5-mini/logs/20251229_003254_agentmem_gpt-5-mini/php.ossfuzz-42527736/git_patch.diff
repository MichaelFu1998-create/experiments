diff --git a/ext/standard/file.c b/ext/standard/file.c
index edaba57748c..2e8fb6b8127 100644
--- a/ext/standard/file.c
+++ b/ext/standard/file.c
@@ -1995,26 +1995,52 @@ PHPAPI HashTable *php_fgetcsv(php_stream *stream, char delimiter, char enclosure
 					case 0:
 						switch (state) {
 							case 2:
-								memcpy(tptr, hunk_begin, bptr - hunk_begin - 1);
+								do {
+	ptrdiff_t __diff = bptr - hunk_begin;
+	if (__diff > 1) {
+		size_t __copy_len = (size_t)(__diff - 1);
+		memcpy(tptr, hunk_begin, __copy_len);
+		tptr += __copy_len;
+	}
+} while (0);
 								tptr += (bptr - hunk_begin - 1);
 								hunk_begin = bptr;
 								goto quit_loop_2;
 
 							case 1:
-								memcpy(tptr, hunk_begin, bptr - hunk_begin);
+								do {
+	ptrdiff_t __diff = bptr - hunk_begin;
+	if (__diff > 0) {
+		size_t __copy_len = (size_t)__diff;
+		memcpy(tptr, hunk_begin, __copy_len);
+		tptr += __copy_len;
+	}
+} while (0);
 								tptr += (bptr - hunk_begin);
 								hunk_begin = bptr;
 								ZEND_FALLTHROUGH;
 
 							case 0: {
 								if (hunk_begin != line_end) {
-									memcpy(tptr, hunk_begin, bptr - hunk_begin);
+									do {
+	ptrdiff_t __diff = bptr - hunk_begin;
+	if (__diff > 0) {
+		size_t __copy_len = (size_t)__diff;
+		memcpy(tptr, hunk_begin, __copy_len);
+		tptr += __copy_len;
+	}
+} while (0);
 									tptr += (bptr - hunk_begin);
 									hunk_begin = bptr;
 								}
 
 								/* add the embedded line end to the field */
-								memcpy(tptr, line_end, line_end_len);
+								do {
+	if (line_end_len > 0) {
+		memcpy(tptr, line_end, line_end_len);
+		tptr += line_end_len;
+	}
+} while (0);
 								tptr += line_end_len;
 
 								/* nothing can be fetched if stream is NULL (e.g. str_getcsv()) */
@@ -2076,12 +2102,26 @@ PHPAPI HashTable *php_fgetcsv(php_stream *stream, char delimiter, char enclosure
 							case 2: /* embedded enclosure ? let's check it */
 								if (*bptr != enclosure) {
 									/* real enclosure */
-									memcpy(tptr, hunk_begin, bptr - hunk_begin - 1);
+									do {
+	ptrdiff_t __diff = bptr - hunk_begin;
+	if (__diff > 1) {
+		size_t __copy_len = (size_t)(__diff - 1);
+		memcpy(tptr, hunk_begin, __copy_len);
+		tptr += __copy_len;
+	}
+} while (0);
 									tptr += (bptr - hunk_begin - 1);
 									hunk_begin = bptr;
 									goto quit_loop_2;
 								}
-								memcpy(tptr, hunk_begin, bptr - hunk_begin);
+								do {
+	ptrdiff_t __diff = bptr - hunk_begin;
+	if (__diff > 0) {
+		size_t __copy_len = (size_t)__diff;
+		memcpy(tptr, hunk_begin, __copy_len);
+		tptr += __copy_len;
+	}
+} while (0);
 								tptr += (bptr - hunk_begin);
 								bptr++;
 								hunk_begin = bptr;
@@ -2102,13 +2142,27 @@ PHPAPI HashTable *php_fgetcsv(php_stream *stream, char delimiter, char enclosure
 						switch (state) {
 							case 2:
 								/* real enclosure */
-								memcpy(tptr, hunk_begin, bptr - hunk_begin - 1);
+								do {
+	ptrdiff_t __diff = bptr - hunk_begin;
+	if (__diff > 1) {
+		size_t __copy_len = (size_t)(__diff - 1);
+		memcpy(tptr, hunk_begin, __copy_len);
+		tptr += __copy_len;
+	}
+} while (0);
 								tptr += (bptr - hunk_begin - 1);
 								hunk_begin = bptr;
 								goto quit_loop_2;
 							case 1:
 								bptr += inc_len;
-								memcpy(tptr, hunk_begin, bptr - hunk_begin);
+								do {
+	ptrdiff_t __diff = bptr - hunk_begin;
+	if (__diff > 0) {
+		size_t __copy_len = (size_t)__diff;
+		memcpy(tptr, hunk_begin, __copy_len);
+		tptr += __copy_len;
+	}
+} while (0);
 								tptr += (bptr - hunk_begin);
 								hunk_begin = bptr;
 								state = 0;
@@ -2147,7 +2201,14 @@ PHPAPI HashTable *php_fgetcsv(php_stream *stream, char delimiter, char enclosure
 			}
 
 		quit_loop_3:
-			memcpy(tptr, hunk_begin, bptr - hunk_begin);
+			do {
+	ptrdiff_t __diff = bptr - hunk_begin;
+	if (__diff > 0) {
+		size_t __copy_len = (size_t)__diff;
+		memcpy(tptr, hunk_begin, __copy_len);
+		tptr += __copy_len;
+	}
+} while (0);
 			tptr += (bptr - hunk_begin);
 			bptr += inc_len;
 			comp_end = tptr;
@@ -2177,7 +2238,14 @@ PHPAPI HashTable *php_fgetcsv(php_stream *stream, char delimiter, char enclosure
 				inc_len = (bptr < limit ? (*bptr == '\0' ? 1 : php_mblen(bptr, limit - bptr)): 0);
 			}
 		quit_loop_4:
-			memcpy(tptr, hunk_begin, bptr - hunk_begin);
+			do {
+	ptrdiff_t __diff = bptr - hunk_begin;
+	if (__diff > 0) {
+		size_t __copy_len = (size_t)__diff;
+		memcpy(tptr, hunk_begin, __copy_len);
+		tptr += __copy_len;
+	}
+} while (0);
 			tptr += (bptr - hunk_begin);
 
 			comp_end = (char *)php_fgetcsv_lookup_trailing_spaces(temp, tptr - temp);
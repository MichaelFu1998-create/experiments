diff --git a/coders/pnm.c b/coders/pnm.c
index afaea309d..87c4d0a5d 100644
--- a/coders/pnm.c
+++ b/coders/pnm.c
@@ -35,7 +35,8 @@
 %
 %
 */
-
+
+
 /*
   Include declarations.
 */
@@ -65,7 +66,8 @@
 #include "MagickCore/statistic.h"
 #include "MagickCore/string_.h"
 #include "MagickCore/string-private.h"
-
+
+
 /*
   Typedef declarations.
 */
@@ -77,13 +79,15 @@ typedef struct _CommentInfo
   size_t
     extent;
 } CommentInfo;
-
+
+
 /*
   Forward declarations.
 */
 static MagickBooleanType
   WritePNMImage(const ImageInfo *,Image *,ExceptionInfo *);
-
+
+
 /*
 %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
 %                                                                             %
@@ -120,7 +124,8 @@ static MagickBooleanType IsPNM(const unsigned char *magick,const size_t extent)
     return(MagickTrue);
   return(MagickFalse);
 }
-
+
+
 /*
 %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
 %                                                                             %
@@ -1392,7 +1397,8 @@ static Image *ReadPNMImage(const ImageInfo *image_info,ExceptionInfo *exception)
     return(DestroyImageList(image));
   return(GetFirstImageInList(image));
 }
-
+
+
 /*
 %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
 %                                                                             %
@@ -1461,7 +1467,8 @@ ModuleExport size_t RegisterPNMImage(void)
   (void) RegisterMagickInfo(entry);
   return(MagickImageCoderSignature);
 }
-
+
+
 /*
 %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
 %                                                                             %
@@ -1489,7 +1496,8 @@ ModuleExport void UnregisterPNMImage(void)
   (void) UnregisterMagickInfo("PNM");
   (void) UnregisterMagickInfo("PPM");
 }
-
+
+
 /*
 %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
 %                                                                             %
@@ -1754,15 +1762,25 @@ static MagickBooleanType WritePNMImage(const ImageInfo *image_info,Image *image,
             break;
           for (x=0; x < (ssize_t) image->columns; x++)
           {
-            *q++=(unsigned char) (GetPixelLuma(image,p) >= (QuantumRange/2.0) ?
-              '0' : '1');
-            *q++=' ';
-            if ((q-pixels+1) >= (ssize_t) sizeof(pixels))
+            /* ensure there is room for two characters and possible newline */
+            if ((q-pixels+2) >= (ssize_t) sizeof(pixels))
+              {
+                /* append newline if space remains, then flush */
+                if ((q-pixels) < (ssize_t) sizeof(pixels))
+                  *q++='\n';
+                (void) WriteBlob(image,q-pixels,pixels);
+                q=pixels;
+              }
+            /* ensure there is room for two characters and possible newline */
+            if ((q-pixels+2) >= (ssize_t) sizeof(pixels))
               {
                 *q++='\n';
                 (void) WriteBlob(image,q-pixels,pixels);
                 q=pixels;
               }
+            *q++=(unsigned char) (GetPixelLuma(image,p) >= (QuantumRange/2.0) ?
+              '0' : '1');
+            *q++=' ';
             p+=GetPixelChannels(image);
           }
           *q++='\n';
@@ -1778,7 +1796,8 @@ static MagickBooleanType WritePNMImage(const ImageInfo *image_info,Image *image,
         }
         if (q != pixels)
           {
-            *q++='\n';
+            if ((q-pixels) < (ssize_t) sizeof(pixels))
+              *q++='\n';
             (void) WriteBlob(image,q-pixels,pixels);
           }
         break;
@@ -1847,7 +1866,8 @@ static MagickBooleanType WritePNMImage(const ImageInfo *image_info,Image *image,
         }
         if (q != pixels)
           {
-            *q++='\n';
+            if ((q-pixels) < (ssize_t) sizeof(pixels))
+              *q++='\n';
             (void) WriteBlob(image,q-pixels,pixels);
           }
         break;
@@ -1922,7 +1942,8 @@ static MagickBooleanType WritePNMImage(const ImageInfo *image_info,Image *image,
         }
         if (q != pixels)
           {
-            *q++='\n';
+            if ((q-pixels) < (ssize_t) sizeof(pixels))
+              *q++='\n';
             (void) WriteBlob(image,q-pixels,pixels);
           }
         break;
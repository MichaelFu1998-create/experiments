diff --git a/src/media_tools/media_export.c b/src/media_tools/media_export.c
index b89936f..fd6f5cd 100644
--- a/src/media_tools/media_export.c
+++ b/src/media_tools/media_export.c
@@ -1108,7 +1108,12 @@ static GF_Err gf_media_export_filters(GF_MediaExporter *dumper)
 		}
 		esd = gf_media_map_esd(dumper->file, track_num, 0);
 		sample_count = gf_isom_get_sample_count(dumper->file, dumper->trackID);
-		if (esd) {
+		/*
+		 * gf_media_map_esd() may return a partially filled ESD for malformed files
+		 * (e.g. missing DecoderConfigDescriptor). In that case, do not dereference
+		 * decoderConfig.
+		 */
+		if (esd && esd->decoderConfig) {
 			if (esd->decoderConfig->objectTypeIndication<GF_CODECID_LAST_MPEG4_MAPPING) {
 				codec_id = gf_codecid_from_oti(esd->decoderConfig->streamType, esd->decoderConfig->objectTypeIndication);
 #ifndef GPAC_DISABLE_AV_PARSERS
@@ -1122,6 +1127,8 @@ static GF_Err gf_media_export_filters(GF_MediaExporter *dumper)
 			} else {
 				codec_id = esd->decoderConfig->objectTypeIndication;
 			}
+		} else if (esd) {
+			GF_LOG(GF_LOG_WARNING, GF_LOG_AUTHOR, ("[Exporter] Missing decoder config for track %d, guessing codec from ISOBMFF subtype\n", dumper->trackID));
 		}
 		if (!codec_id) {
 			msubtype = gf_isom_get_media_subtype(dumper->file, track_num, 1);
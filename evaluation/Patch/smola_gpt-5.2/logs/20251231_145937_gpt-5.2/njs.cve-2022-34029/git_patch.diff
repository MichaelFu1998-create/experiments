diff --git a/src/njs_scope.h b/src/njs_scope.h
index 4164617..0d4117a 100644
--- a/src/njs_scope.h
+++ b/src/njs_scope.h
@@ -71,8 +71,36 @@ njs_scope_index_value(njs_index_t index)
 njs_inline njs_value_t *
 njs_scope_value(njs_vm_t *vm, njs_index_t index)
 {
-    return vm->levels[njs_scope_index_type(index)]
-                     [njs_scope_index_value(index)];
+    njs_level_type_t  type;
+    njs_value_t       **level;
+
+    /*
+     * The bytecode may contain NJS_INDEX_ERROR in some error paths.
+     * Also, in case of a corrupted/invalid index, avoid NULL dereference.
+     *
+     * Returning a valid writable cell prevents crashes and keeps the VM
+     * running until the error is handled by higher-level logic.
+     */
+    if (njs_slow_path(index == NJS_INDEX_ERROR)) {
+        njs_set_undefined(&vm->retval);
+        return &vm->retval;
+    }
+
+    type = njs_scope_index_type(index);
+
+    if (njs_slow_path((uint32_t) type >= NJS_LEVEL_MAX)) {
+        njs_set_undefined(&vm->retval);
+        return &vm->retval;
+    }
+
+    level = vm->levels[type];
+
+    if (njs_slow_path(level == NULL)) {
+        njs_set_undefined(&vm->retval);
+        return &vm->retval;
+    }
+
+    return level[njs_scope_index_value(index)];
 }
 
 
@@ -100,8 +128,21 @@ njs_scope_valid_value(njs_vm_t *vm, njs_index_t index)
 njs_inline void
 njs_scope_value_set(njs_vm_t *vm, njs_index_t index, njs_value_t *value)
 {
-    vm->levels[njs_scope_index_type(index)]
-              [njs_scope_index_value(index)] = value;
+    njs_level_type_t  type;
+
+    if (njs_slow_path(index == NJS_INDEX_ERROR)) {
+        return;
+    }
+
+    type = njs_scope_index_type(index);
+
+    if (njs_slow_path((uint32_t) type >= NJS_LEVEL_MAX
+                      || vm->levels[type] == NULL))
+    {
+        return;
+    }
+
+    vm->levels[type][njs_scope_index_value(index)] = value;
 }
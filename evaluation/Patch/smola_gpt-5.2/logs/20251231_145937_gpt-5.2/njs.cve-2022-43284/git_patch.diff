diff --git a/src/njs_scope.h b/src/njs_scope.h
index e7bfa7c..87489bd 100644
--- a/src/njs_scope.h
+++ b/src/njs_scope.h
@@ -78,9 +78,29 @@ njs_scope_value(njs_vm_t *vm, njs_index_t index)
 njs_inline njs_value_t *
 njs_scope_valid_value(njs_vm_t *vm, njs_index_t index)
 {
-    njs_value_t  *value;
+    njs_value_t       *value;
+    njs_level_type_t  type;
+
+    type = njs_scope_index_type(index);
+
+    /*
+     * Defensive checks.
+     *
+     * Some bytecode paths may attempt to access a scope slot when the
+     * corresponding level was not created (e.g. NJS_LEVEL_LOCAL at top-level).
+     * This must not lead to a NULL dereference.
+     */
+    if (njs_slow_path(type >= NJS_LEVEL_MAX || vm->levels[type] == NULL)) {
+        njs_internal_error(vm, "invalid scope access");
+        return NULL;
+    }
+
+    value = vm->levels[type][njs_scope_index_value(index)];
 
-    value = njs_scope_value(vm, index);
+    if (njs_slow_path(value == NULL)) {
+        njs_internal_error(vm, "invalid scope slot");
+        return NULL;
+    }
 
     if (!njs_is_valid(value)) {
         if (njs_scope_index_var(index) <= NJS_VARIABLE_LET) {
diff --git a/src/njs_vmcode.c b/src/njs_vmcode.c
index 3039642..21b1e4e 100644
--- a/src/njs_vmcode.c
+++ b/src/njs_vmcode.c
@@ -1222,6 +1222,10 @@ njs_vmcode_function_copy(njs_vm_t *vm, njs_value_t *value, njs_index_t retidx)
 
     retval = njs_scope_valid_value(vm, retidx);
 
+    if (njs_slow_path(retval == NULL)) {
+        return NJS_ERROR;
+    }
+
     if (njs_is_undefined(retval)) {
         *retval = *value;
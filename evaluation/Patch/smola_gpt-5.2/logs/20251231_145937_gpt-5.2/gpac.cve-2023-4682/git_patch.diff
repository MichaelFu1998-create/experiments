diff --git a/src/filters/dmx_avi.c b/src/filters/dmx_avi.c
index 866a793..09cf585 100644
--- a/src/filters/dmx_avi.c
+++ b/src/filters/dmx_avi.c
@@ -508,14 +508,35 @@ GF_Err avidmx_process(GF_Filter *filter)
 		u32 key;
 		u64 file_offset, cts;
 		u8 *pck_data;
-		s32 size = AVI_frame_size(ctx->avi, ctx->cur_frame);
+		/*
+			AVI_read_frame() consumes data based on AVI->video_pos and increments it.
+			Do not rely on ctx->cur_frame being in sync with AVI internal state, as
+			this can lead to allocating a buffer too small and overflowing it when
+			the actual frame size differs.
+		*/
+		int frame_pos = ctx->avi->video_pos;
+		if (frame_pos < 0) frame_pos = 0;
+		if ((u32) frame_pos != ctx->cur_frame)
+			ctx->cur_frame = (u32) frame_pos;
+		s32 size = AVI_frame_size(ctx->avi, frame_pos);
+		/* Sanity-check frame size to avoid excessive allocations on corrupted indexes */
+		if (size > 0) {
+			if (size > (32*1024*1024)) {
+				size = 0;
+			} else if (ctx->file_size) {
+				u64 pos_check = (u64) AVI_get_video_position(ctx->avi, frame_pos);
+				if ((pos_check==(u64)-1) || (pos_check > ctx->file_size) || ((u64) size > (ctx->file_size - pos_check))) {
+					size = 0;
+				}
+			}
+		}
 		if (!size) {
 			AVI_read_frame(ctx->avi, NULL, &key);
 			ctx->dummy++;
 		}
 		//remove dummy frames
 		else {
-			file_offset = (u64) AVI_get_video_position(ctx->avi, ctx->cur_frame);
+			file_offset = (u64) AVI_get_video_position(ctx->avi, frame_pos);
 			cts = ctx->nb_frame_sent * ctx->fps.den;
 
 			if (size > 4) {
@@ -536,7 +557,8 @@ GF_Err avidmx_process(GF_Filter *filter)
 		}
 		nb_active++;
 
-		ctx->cur_frame++;
+		/* Sync our external notion of current frame with avilib internal state after consumption. */
+		ctx->cur_frame = (u32) ctx->avi->video_pos;
 		if (ctx->cur_frame < ctx->nb_frames)
 			gf_filter_post_process_task(filter);
 		else if (!ctx->video_done) {
@@ -572,6 +594,11 @@ GF_Err avidmx_process(GF_Filter *filter)
 
 restart:
 		size = AVI_audio_size(ctx->avi, st->aud_frame);
+		/* Sanity-check audio chunk size to avoid excessive allocations */
+		if (size > 0) {
+			if (size > (32*1024*1024))
+				size = 0;
+		}
 
 		if (st->seek_to_ts && size) {
 			if (st->seek_to_ts > st->audio_ts) {
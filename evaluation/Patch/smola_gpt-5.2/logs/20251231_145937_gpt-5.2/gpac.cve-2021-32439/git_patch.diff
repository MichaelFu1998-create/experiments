diff --git a/src/isomedia/stbl_write.c b/src/isomedia/stbl_write.c
index 843a308..5b53452 100644
--- a/src/isomedia/stbl_write.c
+++ b/src/isomedia/stbl_write.c
@@ -25,6 +25,8 @@
 
 #include <gpac/internal/isomedia_dev.h>
 
+#include <limits.h>
+
 #ifndef GPAC_DISABLE_ISOM
 
 /*macro used for table gf_realloc - we allocate much more than needed in order to keep the number of
@@ -1619,8 +1621,20 @@ GF_Err stbl_AppendTime(GF_SampleTableBox *stbl, u32 duration, u32 nb_pack)
 GF_Err stbl_AppendSize(GF_SampleTableBox *stbl, u32 size, u32 nb_pack)
 {
 	u32 i;
+	u32 new_count;
 	if (!nb_pack) nb_pack = 1;
 
+	/* Prevent integer overflows leading to undersized allocations and OOB writes
+	 * when appending packed samples (nb_pack can come from a corrupted file).
+	 */
+	if (stbl && stbl->SampleSize) {
+		if (nb_pack > (u32) (UINT_MAX - stbl->SampleSize->sampleCount)) return GF_ISOM_INVALID_FILE;
+		new_count = stbl->SampleSize->sampleCount + nb_pack;
+		if (new_count < stbl->SampleSize->sampleCount) return GF_ISOM_INVALID_FILE;
+	} else {
+		return GF_BAD_PARAM;
+	}
+
 	if (!stbl->SampleSize->sampleCount) {
 		stbl->SampleSize->sampleSize = size;
 		stbl->SampleSize->sampleCount += nb_pack;
@@ -1630,11 +1644,14 @@ GF_Err stbl_AppendSize(GF_SampleTableBox *stbl, u32 size, u32 nb_pack)
 		stbl->SampleSize->sampleCount += nb_pack;
 		return GF_OK;
 	}
-	if (!stbl->SampleSize->sizes || (stbl->SampleSize->sampleCount+nb_pack > stbl->SampleSize->alloc_size)) {
+	if (!stbl->SampleSize->sizes || (new_count > stbl->SampleSize->alloc_size)) {
 		Bool init_table = (stbl->SampleSize->sizes==NULL) ? 1 : 0;
 		ALLOC_INC(stbl->SampleSize->alloc_size);
-		if (stbl->SampleSize->sampleCount+nb_pack > stbl->SampleSize->alloc_size)
-			stbl->SampleSize->alloc_size = stbl->SampleSize->sampleCount+nb_pack;
+		if (new_count > stbl->SampleSize->alloc_size)
+			stbl->SampleSize->alloc_size = new_count;
+
+		/* avoid size_t overflow in allocation size computation */
+		if ((size_t) stbl->SampleSize->alloc_size > ((size_t)-1) / sizeof(u32)) return GF_OUT_OF_MEM;
 
 		stbl->SampleSize->sizes = (u32 *)gf_realloc(stbl->SampleSize->sizes, sizeof(u32)*stbl->SampleSize->alloc_size);
 		if (!stbl->SampleSize->sizes) return GF_OUT_OF_MEM;
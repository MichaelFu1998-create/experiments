diff --git a/src/mat.c b/src/mat.c
index a0bc257..267a3ed 100644
--- a/src/mat.c
+++ b/src/mat.c
@@ -1815,7 +1815,10 @@ Mat_VarPrint( matvar_t *matvar, int printdata )
         }
         printf("\n");
     }
-    printf("Class Type: %s",class_type_desc[matvar->class_type]);
+    if ( (size_t)matvar->class_type < (sizeof(class_type_desc)/sizeof(class_type_desc[0])) )
+        printf("Class Type: %s",class_type_desc[matvar->class_type]);
+    else
+        printf("Class Type: %d", matvar->class_type);
     if ( matvar->isComplex )
         printf(" (complex)");
     else if ( matvar->isLogical )
@@ -1832,7 +1835,10 @@ Mat_VarPrint( matvar_t *matvar, int printdata )
            "Unicode UTF-16 Encoded Character Data",
            "Unicode UTF-32 Encoded Character Data","","String","Cell Array",
            "Structure"};
-        printf(" Data Type: %s\n", data_type_desc[matvar->data_type]);
+        if ( (size_t)matvar->data_type < (sizeof(data_type_desc)/sizeof(data_type_desc[0])) )
+            printf(" Data Type: %s\n", data_type_desc[matvar->data_type]);
+        else
+            printf(" Data Type: %d\n", matvar->data_type);
     }
 
     if ( MAT_C_STRUCT == matvar->class_type ) {
diff --git a/src/mat5.c b/src/mat5.c
index 2841b58..d6621c2 100644
--- a/src/mat5.c
+++ b/src/mat5.c
@@ -5752,11 +5752,48 @@ Mat_VarReadNextInfo5( mat_t *mat )
                     i = len;
                 else
                     i = len+(8-(len % 8));
-                bytesread+=fread(buf,1,i,(FILE*)mat->fp);
 
-                matvar->name = (char*)malloc(len+1);
-                memcpy(matvar->name,buf,len);
+                /*
+                 * Read the variable name safely.
+                 *
+                 * Previously, the code read i (padded) bytes into the local
+                 * buffer `buf` (6*uint32_t = 24 bytes). For long variable
+                 * names, this overflows `buf`.
+                 */
+                matvar->name = (char*)malloc((size_t)len+1);
+                if ( NULL == matvar->name ) {
+                    Mat_Critical("Error allocating memory for variable name");
+                    (void)fseek((FILE*)mat->fp,i,SEEK_CUR);
+                    break;
+                }
+
+                if ( len > 0 ) {
+                    size_t readresult = fread(matvar->name,1,(size_t)len,(FILE*)mat->fp);
+                    if ( readresult != (size_t)len ) {
+                        free(matvar->name);
+                        matvar->name = NULL;
+                        Mat_Critical("An error occurred in reading the MAT file");
+                        break;
+                    }
+                }
                 matvar->name[len] = '\0';
+                bytesread += (size_t)len;
+
+                /* Skip padding bytes (up to 7) */
+                if ( i > len ) {
+                    size_t pad = (size_t)(i-len);
+                    char padbuf[8];
+                    while ( pad > 0 ) {
+                        size_t chunk = pad > sizeof(padbuf) ? sizeof(padbuf) : pad;
+                        size_t readresult = fread(padbuf,1,chunk,(FILE*)mat->fp);
+                        if ( readresult != chunk ) {
+                            Mat_Critical("An error occurred in reading the MAT file");
+                            break;
+                        }
+                        bytesread += chunk;
+                        pad -= chunk;
+                    }
+                }
             } else if ( ((buf[0] & 0x0000ffff) == MAT_T_INT8) &&
                         ((buf[0] & 0xffff0000) != 0x00) ) {
                 /* Name packed in the tag */
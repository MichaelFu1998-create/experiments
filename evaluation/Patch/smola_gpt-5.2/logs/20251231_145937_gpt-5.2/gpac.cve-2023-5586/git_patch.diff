diff --git a/src/filter_core/filter_pck.c b/src/filter_core/filter_pck.c
index b093e8a..1efae02 100644
--- a/src/filter_core/filter_pck.c
+++ b/src/filter_core/filter_pck.c
@@ -105,12 +105,22 @@ static GF_FilterPacket *gf_filter_pck_new_alloc_internal(GF_FilterPid *pid, u32
 	GF_FilterPacket *closest=NULL;
 	u32 count, max_reservoir_size;
 
+	/*
+	 * pid is expected to be a valid output PID. Some error paths in filters may
+	 * call packet allocation before the output pid is created/attached, leading
+	 * to NULL pointer dereferences (see ASan reports).
+	 */
+	if (!pid || !pid->filter) {
+		GF_LOG(GF_LOG_ERROR, GF_LOG_FILTER, ("Attempt to allocate a packet on a NULL PID\n"));
+		return NULL;
+	}
+
 	if (PID_IS_INPUT(pid)) {
 		GF_LOG(GF_LOG_ERROR, GF_LOG_FILTER, ("Attempt to allocate a packet on an input PID in filter %s\n", pid->filter->name));
 		return NULL;
 	}
 
-	count = gf_fq_count(pid->filter->pcks_alloc_reservoir);
+	count = pid->filter->pcks_alloc_reservoir ? gf_fq_count(pid->filter->pcks_alloc_reservoir) : 0;
 
 	if (count) {
 		//don't let reservoir grow too large (may happen if burst of packets are stored/consumed in the upper chain)
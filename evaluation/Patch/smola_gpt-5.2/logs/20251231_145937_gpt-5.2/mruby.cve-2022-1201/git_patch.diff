diff --git a/src/vm.c b/src/vm.c
index 77edbb3..6480d07 100644
--- a/src/vm.c
+++ b/src/vm.c
@@ -1746,9 +1746,19 @@ RETRY_TRY_BLOCK:
       }
       if (target_class->flags & MRB_FL_CLASS_IS_PREPENDED) {
         target_class = mrb_vm_ci_target_class(ci);
+        if (!target_class) {
+          mrb_value exc = mrb_exc_new_lit(mrb, E_NOMETHOD_ERROR, "super called outside of method");
+          mrb_exc_set(mrb, exc);
+          goto L_RAISE;
+        }
       }
       else if (target_class->tt == MRB_TT_MODULE) {
         target_class = mrb_vm_ci_target_class(ci);
+        if (!target_class) {
+          mrb_value exc = mrb_exc_new_lit(mrb, E_NOMETHOD_ERROR, "super called outside of method");
+          mrb_exc_set(mrb, exc);
+          goto L_RAISE;
+        }
         if (target_class->tt != MRB_TT_ICLASS) {
           goto super_typeerror;
         }
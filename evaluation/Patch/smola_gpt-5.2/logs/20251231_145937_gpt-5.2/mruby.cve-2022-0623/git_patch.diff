diff --git a/src/hash.c b/src/hash.c
index fc6b6fa..9317308 100644
--- a/src/hash.c
+++ b/src/hash.c
@@ -1151,6 +1151,16 @@ static mrb_value mrb_hash_default(mrb_state *mrb, mrb_value hash);
 static void
 hash_modify(mrb_state *mrb, mrb_value hash)
 {
+  /*
+   * mrb_hash_set() can be reached from the VM (OP_HASH/OP_HASHADD).
+   * If malformed bytecode passes a non-Hash value here, mrb_hash_ptr()
+   * would interpret an immediate value as a pointer, and mrb_check_frozen()
+   * would dereference it, leading to a crash.
+   *
+   * Ensure the value is actually a Hash before touching its internal fields.
+   *
+   */
+  mrb_check_type(mrb, hash, MRB_TT_HASH);
   mrb_check_frozen(mrb, mrb_hash_ptr(hash));
 }
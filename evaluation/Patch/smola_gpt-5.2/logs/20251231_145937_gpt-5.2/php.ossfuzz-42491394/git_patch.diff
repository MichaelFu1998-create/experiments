diff --git a/ext/spl/spl_observer.c b/ext/spl/spl_observer.c
index c83e8bf3a9f..eafda6d5561 100644
--- a/ext/spl/spl_observer.c
+++ b/ext/spl/spl_observer.c
@@ -764,8 +764,22 @@ PHP_METHOD(SplObjectStorage, unserialize)
 			var_push_dtor(&var_hash, &obj);
 		}
 		element = spl_object_storage_attach(intern, Z_OBJ(entry), Z_ISUNDEF(inf)?NULL:&inf);
-		ZVAL_OBJ(&obj, element->obj);
-		var_replace(&var_hash, &entry, &obj);
+		/*
+		 * This method may be called from within the global unserialize() implementation.
+		 * In this case var_hash is shared between nested unserialization calls.
+		 *
+		 * php_var_unserialize() stores pointers to zvals in var_hash for reference
+		 * resolution. Do not store pointers to stack zvals there, as they become
+		 * dangling after this method returns.
+		 */
+		zval *obj_tmp = var_tmp_var(&var_hash);
+		if (UNEXPECTED(!obj_tmp)) {
+			zval_ptr_dtor(&entry);
+			zval_ptr_dtor(&inf);
+			goto outexcept;
+		}
+		ZVAL_OBJ_COPY(obj_tmp, element->obj);
+		var_replace(&var_hash, &entry, obj_tmp);
 		var_replace(&var_hash, &inf, &element->inf);
 		zval_ptr_dtor(&entry);
 		ZVAL_UNDEF(&entry);
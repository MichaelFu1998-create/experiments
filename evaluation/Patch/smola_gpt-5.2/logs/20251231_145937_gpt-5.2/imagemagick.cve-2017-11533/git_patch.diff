diff --git a/coders/uil.c b/coders/uil.c
index beda560..e44fa40 100644
--- a/coders/uil.c
+++ b/coders/uil.c
@@ -263,6 +263,12 @@ static MagickBooleanType WriteUILImage(const ImageInfo *image_info,Image *image,
             *q;
 
           colors++;
+          /*
+            The matte_image buffer has one byte per pixel.  Reset the matte
+            index before we walk the image a second time and ensure we advance
+            it for each pixel to avoid reading past the end of the buffer.
+          */
+          i=0;
           for (y=0; y < (ssize_t) image->rows; y++)
           {
             q=GetAuthenticPixels(image,0,y,image->columns,1,exception);
@@ -273,6 +279,7 @@ static MagickBooleanType WriteUILImage(const ImageInfo *image_info,Image *image,
               if (matte_image[i] != 0)
                 SetPixelIndex(image,(Quantum) image->colors,q);
               q+=GetPixelChannels(image);
+              i++;
             }
           }
         }
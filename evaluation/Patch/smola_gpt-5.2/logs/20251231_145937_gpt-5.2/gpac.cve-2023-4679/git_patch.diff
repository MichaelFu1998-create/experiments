diff --git a/src/isomedia/media.c b/src/isomedia/media.c
index 2a2d614..09473e7 100644
--- a/src/isomedia/media.c
+++ b/src/isomedia/media.c
@@ -616,9 +616,18 @@ GF_Err Media_GetSample(GF_MediaBox *mdia, u32 sampleNumber, GF_ISOSample **samp,
 		/*and finally get the data, include padding if needed*/
 		if ((*samp)->alloc_size) {
 			if ((*samp)->alloc_size < data_size + mdia->mediaTrack->padding_bytes) {
-				(*samp)->data = (char *) gf_realloc((*samp)->data, sizeof(char) * ( data_size + mdia->mediaTrack->padding_bytes) );
+				/*
+				 * When ext_realloc is set, the sample buffer can be provided by an external allocator
+				 * (eg a filter packet reservoir). We must never gf_realloc() such memory since it
+				 * can release/replace the buffer behind the owner, leading to use-after-free/double-free
+				 * when the owner later destroys it.
+				 */
+				if (ext_realloc) {
+					(*samp)->data = mdia->mediaTrack->sample_alloc_cbk(data_size + mdia->mediaTrack->padding_bytes, mdia->mediaTrack->sample_alloc_udta);
+				} else {
+					(*samp)->data = (char *) gf_realloc((*samp)->data, sizeof(char) * ( data_size + mdia->mediaTrack->padding_bytes) );
+				}
 				if (! (*samp)->data) return GF_OUT_OF_MEM;
-
 				(*samp)->alloc_size = data_size + mdia->mediaTrack->padding_bytes;
 			}
 		} else {
@@ -628,6 +637,7 @@ GF_Err Media_GetSample(GF_MediaBox *mdia, u32 sampleNumber, GF_ISOSample **samp,
 				(*samp)->data = (u8 *) gf_malloc(data_size + mdia->mediaTrack->padding_bytes);
 			}
 			if (! (*samp)->data) return GF_OUT_OF_MEM;
+			(*samp)->alloc_size = data_size + mdia->mediaTrack->padding_bytes;
 		}
 		(*samp)->dataLength = data_size;
 		if (mdia->mediaTrack->padding_bytes)
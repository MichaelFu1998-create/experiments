diff --git a/src/njs_object.c b/src/njs_object.c
index ad03bc3..62625b5 100644
--- a/src/njs_object.c
+++ b/src/njs_object.c
@@ -2111,11 +2111,26 @@ static njs_int_t
 njs_object_set_prototype(njs_vm_t *vm, njs_object_t *object,
     const njs_value_t *value)
 {
-    const njs_object_t *proto;
+    const njs_object_t  *proto, *new_proto;
 
-    proto = njs_object(value);
+    /*
+     * "value" is expected to be an Object or Null (ES [[SetPrototypeOf]]).
+     * Some internal call paths may still pass other value types.
+     * Accessing value->data.u.object unconditionally may interpret unrelated
+     * bits as a pointer and lead to an invalid dereference while walking the
+     * prototype chain.
+     */
+    if (njs_is_null(value)) {
+        new_proto = NULL;
+
+    } else if (njs_is_object(value)) {
+        new_proto = njs_object(value);
+
+    } else {
+        return NJS_DECLINED;
+    }
 
-    if (njs_slow_path(object->__proto__ == proto)) {
+    if (njs_slow_path(object->__proto__ == new_proto)) {
         return NJS_OK;
     }
 
@@ -2123,11 +2138,13 @@ njs_object_set_prototype(njs_vm_t *vm, njs_object_t *object,
         return NJS_DECLINED;
     }
 
-    if (njs_slow_path(proto == NULL)) {
+    if (njs_slow_path(new_proto == NULL)) {
         object->__proto__ = NULL;
         return NJS_OK;
     }
 
+    proto = new_proto;
+
     do {
         if (proto == object) {
             return NJS_ERROR;
@@ -2137,7 +2154,7 @@ njs_object_set_prototype(njs_vm_t *vm, njs_object_t *object,
 
     } while (proto != NULL);
 
-    object->__proto__ = njs_object(value);
+    object->__proto__ = (njs_object_t *) new_proto;
 
     return NJS_OK;
 }
diff --git a/src/njs_value.h b/src/njs_value.h
index 12448ea..4fcd8fc 100644
--- a/src/njs_value.h
+++ b/src/njs_value.h
@@ -592,7 +592,7 @@ typedef struct {
 
 
 #define njs_is_object(value)                                                  \
-    ((value)->type >= NJS_OBJECT)
+    ((value)->type >= NJS_OBJECT && (value)->type < NJS_VALUE_TYPE_MAX)
 
 
 #define njs_has_prototype(vm, value, proto)                                   \
diff --git a/src/scenegraph/vrml_proto.c b/src/scenegraph/vrml_proto.c
index df30ed0..df492ec 100644
--- a/src/scenegraph/vrml_proto.c
+++ b/src/scenegraph/vrml_proto.c
@@ -1272,33 +1272,60 @@ u32 gf_sg_proto_get_root_tag(GF_Proto *proto)
 	return n->sgprivate->tag;
 }
 
+
 GF_EXPORT
-Bool gf_sg_proto_field_is_sftime_offset(GF_Node *node, GF_FieldInfo *field)
+static Bool gf_sg_proto_field_is_sftime_offset_internal(GF_Node *node, GF_FieldInfo *field, GF_List *visited)
 {
 	u32 i;
 	GF_Route *r;
 	GF_ProtoInstance *inst;
 	GF_FieldInfo inf;
+
+	if (!node || !field) return 0;
+	if (!node->sgprivate) return 0;
 	if (node->sgprivate->tag != TAG_ProtoNode) return 0;
 	if (field->fieldType != GF_SG_VRML_SFTIME) return 0;
 
 	inst = (GF_ProtoInstance *) node;
+	if (!inst->proto_interface || !inst->proto_interface->sub_graph || !inst->proto_interface->sub_graph->Routes)
+		return 0;
+
+	/* Prevent infinite recursion when IS routes create cycles between proto instances */
+	if (visited) {
+		if (gf_list_find(visited, node) >= 0)
+			return 0;
+		gf_list_add(visited, node);
+	}
+
 	/*check in interface if this is ISed */
 	i=0;
 	while ((r = (GF_Route*)gf_list_enum(inst->proto_interface->sub_graph->Routes, &i))) {
 		if (!r->IS_route) continue;
 		/*only check eventIn/field/exposedField*/
 		if (r->FromNode || (r->FromField.fieldIndex != field->fieldIndex)) continue;
+		if (!r->ToNode) continue;
 
 		gf_node_get_field(r->ToNode, r->ToField.fieldIndex, &inf);
 		/*IS to another proto*/
-		if (r->ToNode->sgprivate->tag == TAG_ProtoNode) return gf_sg_proto_field_is_sftime_offset(r->ToNode, &inf);
+		if (r->ToNode->sgprivate && (r->ToNode->sgprivate->tag == TAG_ProtoNode))
+			return gf_sg_proto_field_is_sftime_offset_internal(r->ToNode, &inf, visited);
 		/*IS to a startTime/stopTime field*/
 		if (!stricmp(inf.name, "startTime") || !stricmp(inf.name, "stopTime")) return 1;
 	}
 	return 0;
 }
 
+GF_EXPORT
+Bool gf_sg_proto_field_is_sftime_offset(GF_Node *node, GF_FieldInfo *field)
+{
+	Bool res;
+	GF_List *visited = gf_list_new();
+	res = gf_sg_proto_field_is_sftime_offset_internal(node, field, visited);
+	gf_list_del(visited);
+	return res;
+}
+
+
 GF_EXPORT
 GF_Err gf_node_proto_set_grouping(GF_Node *node)
 {
diff --git a/src/vm.c b/src/vm.c
index b04c9d7..142c92d 100644
--- a/src/vm.c
+++ b/src/vm.c
@@ -1163,9 +1163,23 @@ static mrb_value
 hash_new_from_values(mrb_state *mrb, mrb_int argc, mrb_value *regs)
 {
   mrb_value hash = mrb_hash_new_capa(mrb, argc);
+  /*
+   * NOTE: mrb_hash_set() can execute Ruby code (e.g. via #eql?) which can
+   * extend and reallocate the VM stack. If we iterate using the raw 'regs'
+   * pointer, it may become dangling (use-after-free).
+   *
+   * Use an index relative to the current callinfo stack base and refresh
+   * the pointer on each iteration.
+   */
+  struct mrb_context *c = mrb->c;
+  ptrdiff_t off = regs - c->ci->stack;
+
   while (argc--) {
-    mrb_hash_set(mrb, hash, regs[0], regs[1]);
-    regs += 2;
+    regs = c->ci->stack + off;
+    mrb_value k = regs[0];
+    mrb_value v = regs[1];
+    mrb_hash_set(mrb, hash, k, v);
+    off += 2;
   }
   return hash;
 }
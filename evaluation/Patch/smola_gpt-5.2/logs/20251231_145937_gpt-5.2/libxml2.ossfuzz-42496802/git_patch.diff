diff --git a/parser.c b/parser.c
index 9bda9458..b6096496 100644
--- a/parser.c
+++ b/parser.c
@@ -9928,7 +9928,9 @@ xmlParseContent(xmlParserCtxtPtr ctxt) {
 
     if ((ctxt->instate != XML_PARSER_EOF) && (ctxt->nameNr > nameNr)) {
         const xmlChar *name = ctxt->nameTab[ctxt->nameNr - 1];
-        int line = ctxt->pushTab[ctxt->nameNr - 1].line;
+        int line = (ctxt->pushTab != NULL) ?
+            ctxt->pushTab[ctxt->nameNr - 1].line :
+            ((ctxt->input != NULL) ? ctxt->input->line : 0);
         xmlFatalErrMsgStrIntStr(ctxt, XML_ERR_TAG_NOT_FINISHED,
                 "Premature end of data in tag %s line %d\n",
 		name, line, NULL);
@@ -9959,12 +9961,40 @@ xmlParseElement(xmlParserCtxtPtr ctxt) {
 	return;
 
     if (CUR == 0) {
-        const xmlChar *name = ctxt->nameTab[ctxt->nameNr - 1];
-        int line = ctxt->pushTab[ctxt->nameNr - 1].line;
+
+        const xmlChar *name;
+
+        int line;
+
+
+        if (ctxt->nameNr > 0) {
+
+            name = ctxt->nameTab[ctxt->nameNr - 1];
+
+            if (ctxt->pushTab != NULL)
+
+                line = ctxt->pushTab[ctxt->nameNr - 1].line;
+
+            else
+
+                line = (ctxt->input != NULL) ? ctxt->input->line : 0;
+
+        } else {
+
+            name = BAD_CAST "unknown";
+
+            line = (ctxt->input != NULL) ? ctxt->input->line : 0;
+
+        }
+
         xmlFatalErrMsgStrIntStr(ctxt, XML_ERR_TAG_NOT_FINISHED,
+
                 "Premature end of data in tag %s line %d\n",
-		name, line, NULL);
+
+    		name, line, NULL);
+
         return;
+
     }
 
     xmlParseElementEnd(ctxt);
diff --git a/libqpdf/Pl_ASCII85Decoder.cc b/libqpdf/Pl_ASCII85Decoder.cc
index b8df3e8..0b2cd85 100644
--- a/libqpdf/Pl_ASCII85Decoder.cc
+++ b/libqpdf/Pl_ASCII85Decoder.cc
@@ -118,8 +118,23 @@ Pl_ASCII85Decoder::flush()
     }
 
     QTC::TC("libtests", "Pl_ASCII85Decoder partial flush",
-	    (this->pos == 5) ? 0 : 1);
-    getNext()->write(outbuf, this->pos - 1);
+            (this->pos == 5) ? 0 : 1);
+    // If the downstream pipeline throws, ensure that our internal state is
+    // reset before allowing the exception to propagate. Otherwise, callers
+    // that catch an exception and continue using this pipeline could cause
+    // pos to remain at 5, leading to out-of-bounds writes on subsequent
+    // calls to write().
+    size_t bytes = this->pos - 1;
+    try
+    {
+        getNext()->write(outbuf, bytes);
+    }
+    catch (...)
+    {
+        this->pos = 0;
+        memset(this->inbuf, 117, 5);
+        throw;
+    }
 
     this->pos = 0;
     memset(this->inbuf, 117, 5);
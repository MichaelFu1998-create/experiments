diff --git a/programs/sndfile-deinterleave.c b/programs/sndfile-deinterleave.c
index e27593e..90334c3 100644
--- a/programs/sndfile-deinterleave.c
+++ b/programs/sndfile-deinterleave.c
@@ -89,6 +89,12 @@ main (int argc, char **argv)
 		exit (1) ;
 		} ;
 
+	/* Sanity check: this program only supports up to MAX_CHANNELS channels. */
+	if (sfinfo.channels > MAX_CHANNELS)
+	{	printf ("\nError : Input file '%s' has too many channels (%d). Max supported is %d.\n",
+			argv [1], sfinfo.channels, MAX_CHANNELS) ;
+		exit (1) ;
+	} ;
 	state.channels = sfinfo.channels ;
 	sfinfo.channels = 1 ;
 
@@ -168,7 +174,8 @@ deinterleave_int (STATE * state)
 		for (ch = 0 ; ch < state->channels ; ch ++)
 		{	for (k = 0 ; k < read_len ; k++)
 				state->dout.i [k] = state->din.i [k * state->channels + ch] ;
-			sf_write_int (state->outfile [ch], state->dout.i, read_len) ;
+			if (state->outfile[ch] != NULL)
+			    sf_write_int(state->outfile[ch], state->dout.i, read_len);
 			} ;
 		}
 	while (read_len > 0) ;
@@ -186,7 +193,8 @@ deinterleave_double (STATE * state)
 		for (ch = 0 ; ch < state->channels ; ch ++)
 		{	for (k = 0 ; k < read_len ; k++)
 				state->dout.d [k] = state->din.d [k * state->channels + ch] ;
-			sf_write_double (state->outfile [ch], state->dout.d, read_len) ;
+			if (state->outfile[ch] != NULL)
+			    sf_write_double(state->outfile[ch], state->dout.d, read_len);
 			} ;
 		}
 	while (read_len > 0) ;
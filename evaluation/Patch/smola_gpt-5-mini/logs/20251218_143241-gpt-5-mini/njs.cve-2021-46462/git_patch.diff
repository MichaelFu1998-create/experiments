diff --git a/src/njs_object.c b/src/njs_object.c
index ad03bc3..df03b2f 100644
--- a/src/njs_object.c
+++ b/src/njs_object.c
@@ -7,6 +7,32 @@
 
 #include <njs_main.h>
 
+njs_object_t *
+njs_object_alloc(njs_vm_t *vm)
+{
+    njs_object_t  *object;
+
+    object = njs_mp_alloc(vm->mem_pool, sizeof(njs_object_t));
+
+    if (njs_fast_path(object != NULL)) {
+        njs_lvlhsh_init(&object->hash);
+        njs_lvlhsh_init(&object->shared_hash);
+        object->__proto__ = &vm->prototypes[NJS_OBJ_TYPE_OBJECT].object;
+        object->slots = NULL;
+        object->type = NJS_OBJECT;
+        object->shared = 0;
+        object->extensible = 1;
+        object->error_data = 0;
+        object->fast_array = 0;
+
+        return object;
+    }
+
+    njs_memory_error(vm);
+
+    return NULL;
+}
+
 
 typedef enum {
     NJS_OBJECT_INTEGRITY_SEALED,
@@ -31,34 +57,51 @@ static njs_int_t njs_object_own_enumerate_object(njs_vm_t *vm,
     njs_object_enum_t kind, njs_object_enum_type_t type, njs_bool_t all);
 static njs_int_t njs_object_define_properties(njs_vm_t *vm, njs_value_t *args,
     njs_uint_t nargs, njs_index_t unused);
-static njs_int_t njs_object_set_prototype(njs_vm_t *vm, njs_object_t *object,
-    const njs_value_t *value);
+static njs_int_t
+njs_object_set_prototype(njs_vm_t *vm, njs_object_t *object,
+    const njs_value_t *value)
+{
+    const njs_object_t  *proto;
 
+    /* Accept only object or null values as prototype. */
+    if (njs_is_null(value)) {
+        proto = NULL;
 
-njs_object_t *
-njs_object_alloc(njs_vm_t *vm)
-{
-    njs_object_t  *object;
+    } else if (njs_is_object(value)) {
+        proto = njs_object(value);
 
-    object = njs_mp_alloc(vm->mem_pool, sizeof(njs_object_t));
+    } else {
+        /* Invalid prototype type. */
+        njs_type_error(vm, "prototype may only be an object or null: %s",
+                       njs_type_string(value->type));
+        return NJS_ERROR;
+    }
 
-    if (njs_fast_path(object != NULL)) {
-        njs_lvlhsh_init(&object->hash);
-        njs_lvlhsh_init(&object->shared_hash);
-        object->__proto__ = &vm->prototypes[NJS_OBJ_TYPE_OBJECT].object;
-        object->slots = NULL;
-        object->type = NJS_OBJECT;
-        object->shared = 0;
-        object->extensible = 1;
-        object->error_data = 0;
-        object->fast_array = 0;
+    if (njs_slow_path(object->__proto__ == proto)) {
+        return NJS_OK;
+    }
 
-        return object;
+    if (!object->extensible) {
+        return NJS_DECLINED;
     }
 
-    njs_memory_error(vm);
+    if (proto == NULL) {
+        object->__proto__ = NULL;
+        return NJS_OK;
+    }
 
-    return NULL;
+    /* Check for cyclic prototype chain. */
+    while (proto != NULL) {
+        if (proto == object) {
+            return NJS_ERROR;
+        }
+
+        proto = proto->__proto__;
+    }
+
+    object->__proto__ = njs_object(value);
+
+    return NJS_OK;
 }
 
 
@@ -2107,40 +2150,6 @@ const njs_object_init_t  njs_object_constructor_init = {
 };
 
 
-static njs_int_t
-njs_object_set_prototype(njs_vm_t *vm, njs_object_t *object,
-    const njs_value_t *value)
-{
-    const njs_object_t *proto;
-
-    proto = njs_object(value);
-
-    if (njs_slow_path(object->__proto__ == proto)) {
-        return NJS_OK;
-    }
-
-    if (!object->extensible) {
-        return NJS_DECLINED;
-    }
-
-    if (njs_slow_path(proto == NULL)) {
-        object->__proto__ = NULL;
-        return NJS_OK;
-    }
-
-    do {
-        if (proto == object) {
-            return NJS_ERROR;
-        }
-
-        proto = proto->__proto__;
-
-    } while (proto != NULL);
-
-    object->__proto__ = njs_object(value);
-
-    return NJS_OK;
-}
 
 
 njs_int_t
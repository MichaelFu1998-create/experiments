diff --git a/src/hash.c b/src/hash.c
index fc6b6fa..4b6bf2b 100644
--- a/src/hash.c
+++ b/src/hash.c
@@ -1151,9 +1151,17 @@ static mrb_value mrb_hash_default(mrb_state *mrb, mrb_value hash);
 static void
 hash_modify(mrb_state *mrb, mrb_value hash)
 {
+  /* Ensure argument is a Hash value before dereferencing it. This avoids
+   * dereferencing arbitrary small pointers when non-Hash values are passed
+   * (which can happen from generated VM code). mrb_ensure_hash_type will
+   * raise a TypeError for invalid types, preventing the subsequent
+   * mrb_check_frozen from accessing an invalid pointer.
+   */
+  mrb_ensure_hash_type(mrb, hash);
   mrb_check_frozen(mrb, mrb_hash_ptr(hash));
 }
 
+
 static mrb_value
 hash_default(mrb_state *mrb, mrb_value hash, mrb_value key)
 {
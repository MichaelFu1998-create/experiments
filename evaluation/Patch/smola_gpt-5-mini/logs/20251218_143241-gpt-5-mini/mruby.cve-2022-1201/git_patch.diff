diff --git a/src/vm.c b/src/vm.c
index 77edbb3..1e1899c 100644
--- a/src/vm.c
+++ b/src/vm.c
@@ -1733,7 +1733,19 @@ RETRY_TRY_BLOCK:
       mrb_value recv, blk;
       const struct RProc *p = ci->proc;
       mrb_sym mid = ci->mid;
-      struct RClass* target_class = MRB_PROC_TARGET_CLASS(p);
+      struct RClass* target_class = NULL;
+      if (p) {
+        target_class = MRB_PROC_TARGET_CLASS(p);
+      }
+      else {
+        /* fallback to callinfo target class if proc is NULL */
+        target_class = mrb_vm_ci_target_class(ci);
+        if (!target_class) {
+          mrb_value exc = mrb_exc_new_lit(mrb, E_NOMETHOD_ERROR, "super called outside of method");
+          mrb_exc_set(mrb, exc);
+          goto L_RAISE;
+        }
+      }
 
       if (MRB_PROC_ENV_P(p) && p->e.env->mid && p->e.env->mid != mid) { /* alias support */
         mid = p->e.env->mid;    /* restore old mid */
@@ -1746,9 +1758,19 @@ RETRY_TRY_BLOCK:
       }
       if (target_class->flags & MRB_FL_CLASS_IS_PREPENDED) {
         target_class = mrb_vm_ci_target_class(ci);
+        if (!target_class) {
+          mrb_value exc = mrb_exc_new_lit(mrb, E_NOMETHOD_ERROR, "super called outside of method");
+          mrb_exc_set(mrb, exc);
+          goto L_RAISE;
+        }
       }
       else if (target_class->tt == MRB_TT_MODULE) {
         target_class = mrb_vm_ci_target_class(ci);
+        if (!target_class) {
+          mrb_value exc = mrb_exc_new_lit(mrb, E_NOMETHOD_ERROR, "super called outside of method");
+          mrb_exc_set(mrb, exc);
+          goto L_RAISE;
+        }
         if (target_class->tt != MRB_TT_ICLASS) {
           goto super_typeerror;
         }
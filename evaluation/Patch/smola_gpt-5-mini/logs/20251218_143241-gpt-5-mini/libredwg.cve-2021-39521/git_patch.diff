diff --git a/src/bits.c b/src/bits.c
index e187757..e1a614b 100644
--- a/src/bits.c
+++ b/src/bits.c
@@ -103,16 +103,30 @@ void
 bit_reset_chain (Bit_Chain *dat)
 {
   unsigned long pos = dat->byte;
+  if (pos == 0)
+    return;
+  if (dat->chain == NULL)
+    {
+      dat->byte = 0;
+      dat->bit = 0;
+      return;
+    }
+  /* Move remaining data to the start of the buffer instead of
+     shifting the pointer. Shifting the pointer breaks realloc/free
+     later when the original allocation pointer is lost. */
+  memmove(dat->chain, dat->chain + pos, dat->size - pos);
   dat->byte = 0;
-  if (pos < dat->size) // not already overflowed
-    dat->chain += pos;
-  if (dat->size > 0)
+  if (dat->size > pos)
     dat->size -= pos;
+  else
+    dat->size = 0;
+  dat->bit = 0;
 }
 
+
 #ifdef DWG_ABORT
 #  define CHK_OVERFLOW(func, retval)                                          \
-    if (dat->byte >= dat->size)                                               \
+    if (dat == NULL || dat->chain == NULL || dat->byte >= dat->size)                                               \
       {                                                                       \
         loglevel = dat->opts & DWG_OPTS_LOGLEVEL;                             \
         LOG_ERROR ("%s buffer overflow at %lu >= %lu", func, dat->byte,       \
@@ -123,7 +137,7 @@ bit_reset_chain (Bit_Chain *dat)
       }
 #else
 #  define CHK_OVERFLOW(func, retval)                                          \
-    if (dat->byte >= dat->size)                                               \
+    if (dat == NULL || dat->chain == NULL || dat->byte >= dat->size)                                               \
       {                                                                       \
         loglevel = dat->opts & DWG_OPTS_LOGLEVEL;                             \
         LOG_ERROR ("%s buffer overflow at %lu >= %lu", func, dat->byte,       \
@@ -133,7 +147,7 @@ bit_reset_chain (Bit_Chain *dat)
 #endif
 
 #define CHK_OVERFLOW_PLUS(plus, func, retval)                                 \
-    if (dat->byte + (plus) > dat->size)                                       \
+    if (dat == NULL || dat->chain == NULL || dat->byte + (plus) > dat->size)                                       \
       {                                                                       \
         loglevel = dat->opts & DWG_OPTS_LOGLEVEL;                             \
         LOG_ERROR ("%s buffer overflow at %lu + %d >= %lu", func, dat->byte,  \
@@ -162,7 +176,7 @@ bit_read_B (Bit_Chain *dat)
 void
 bit_write_B (Bit_Chain *dat, unsigned char value)
 {
-  if (dat->byte >= dat->size)
+  if (dat == NULL || dat->chain == NULL || dat->byte >= dat->size)
     bit_chain_alloc (dat);
 
   if (value)
@@ -207,7 +221,7 @@ bit_write_BB (Bit_Chain *dat, unsigned char value)
   unsigned char mask;
   unsigned char byte;
 
-  if (dat->byte >= dat->size)
+  if (dat == NULL || dat->chain == NULL || dat->byte >= dat->size)
     bit_chain_alloc (dat);
   byte = dat->chain[dat->byte];
   if (dat->bit < 7)
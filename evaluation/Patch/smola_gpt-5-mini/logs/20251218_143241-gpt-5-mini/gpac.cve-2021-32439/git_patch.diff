diff --git a/src/isomedia/stbl_write.c b/src/isomedia/stbl_write.c
index 843a308..592b0dd 100644
--- a/src/isomedia/stbl_write.c
+++ b/src/isomedia/stbl_write.c
@@ -1621,6 +1621,12 @@ GF_Err stbl_AppendSize(GF_SampleTableBox *stbl, u32 size, u32 nb_pack)
 	u32 i;
 	if (!nb_pack) nb_pack = 1;
 
+	/* guard against integer overflow on sample counts */
+	if (nb_pack && (stbl->SampleSize->sampleCount > (0xFFFFFFFFu - nb_pack))) {
+		/* too many samples would overflow u32 counters */
+		return GF_BAD_PARAM;
+	}
+
 	if (!stbl->SampleSize->sampleCount) {
 		stbl->SampleSize->sampleSize = size;
 		stbl->SampleSize->sampleCount += nb_pack;
@@ -1636,6 +1642,9 @@ GF_Err stbl_AppendSize(GF_SampleTableBox *stbl, u32 size, u32 nb_pack)
 		if (stbl->SampleSize->sampleCount+nb_pack > stbl->SampleSize->alloc_size)
 			stbl->SampleSize->alloc_size = stbl->SampleSize->sampleCount+nb_pack;
 
+		/* protect against size_t overflow for allocation */
+		if ((size_t)stbl->SampleSize->alloc_size > ((size_t)-1) / sizeof(u32)) return GF_OUT_OF_MEM;
+
 		stbl->SampleSize->sizes = (u32 *)gf_realloc(stbl->SampleSize->sizes, sizeof(u32)*stbl->SampleSize->alloc_size);
 		if (!stbl->SampleSize->sizes) return GF_OUT_OF_MEM;
 		memset(&stbl->SampleSize->sizes[stbl->SampleSize->sampleCount], 0, sizeof(u32) * (stbl->SampleSize->alloc_size - stbl->SampleSize->sampleCount) );
@@ -1646,6 +1655,10 @@ GF_Err stbl_AppendSize(GF_SampleTableBox *stbl, u32 size, u32 nb_pack)
 		}
 	}
 	stbl->SampleSize->sampleSize = 0;
+
+	/* ensure we won't write past the allocated buffer */
+	if (stbl->SampleSize->sampleCount + nb_pack > stbl->SampleSize->alloc_size) return GF_OUT_OF_MEM;
+
 	for (i=0; i<nb_pack; i++) {
 		stbl->SampleSize->sizes[stbl->SampleSize->sampleCount+i] = size;
 	}
diff --git a/include/gpac/media_tools.h b/include/gpac/media_tools.h
index b5af010..970e0e9 100644
--- a/include/gpac/media_tools.h
+++ b/include/gpac/media_tools.h
@@ -719,14 +719,12 @@ typedef enum
 	GF_DASH_BSMODE_INBAND,
 	/*! out of band parameter sets except PPS and APS, used for VVC */
 	GF_DASH_BSMODE_INBAND_PPS,
-	/*! both inband and out of band parameter sets */
-	GF_DASH_BSMODE_BOTH, //Romain
 	/*! attempts to merge parameter sets in a single sample entry */
 	GF_DASH_BSMODE_MERGED,
 	/*! parameter sets are in different sample entries */
 	GF_DASH_BSMODE_MULTIPLE_ENTRIES,
 	/*! forces GF_DASH_BSMODE_INBAND even if only one file is used*/
-	GF_DASH_BSMODE_SINGLE,
+	GF_DASH_BSMODE_SINGLE
 } GF_DashSwitchingMode;
 
 
diff --git a/src/bifs/unquantize.c b/src/bifs/unquantize.c
index a43df12..e021b0b 100644
--- a/src/bifs/unquantize.c
+++ b/src/bifs/unquantize.c
@@ -63,9 +63,18 @@ GF_Err gf_bifs_dec_qp_set(GF_BifsDecoder *codec, GF_Node *qp)
 	assert(gf_node_get_tag(qp) == TAG_MPEG4_QuantizationParameter);
 
 	/*if we have an active QP, push it into the stack*/
-	if (codec->ActiveQP && ((GF_Node*)codec->ActiveQP != codec->scenegraph->global_qp) )
+	if (codec->ActiveQP && ((GF_Node*)codec->ActiveQP != codec->scenegraph->global_qp) ) {
+		/* Register the node before storing it in the QPs list so it won't be
+		   freed elsewhere while still referenced in the list. It will be
+		   unregistered when popped/removed via gf_bifs_dec_qp_remove. */
+		gf_node_register((GF_Node*)codec->ActiveQP, NULL);
 		gf_list_insert(codec->QPs, codec->ActiveQP, 0);
+	}
 
+	/* Register the new ActiveQP to ensure it stays alive even if other parts
+	   of the code call gf_node_unregister on it. It will be unregistered when
+	   we remove the ActiveQP via gf_bifs_dec_qp_remove. */
+	gf_node_register(qp, NULL);
 	codec->ActiveQP = (M_QuantizationParameter *)qp;
 	return GF_OK;
 }
@@ -73,9 +82,29 @@ GF_Err gf_bifs_dec_qp_set(GF_BifsDecoder *codec, GF_Node *qp)
 GF_Err gf_bifs_dec_qp_remove(GF_BifsDecoder *codec, Bool ActivatePrev)
 {
 	if (!codec->force_keep_qp && codec->ActiveQP && ((GF_Node*)codec->ActiveQP != codec->scenegraph->global_qp) ) {
-		gf_node_unregister((GF_Node *) codec->ActiveQP, NULL);
+		/* Temporarily take the ActiveQP pointer and clear it in the codec to
+		   avoid any further dereferences while we remove references and
+		   unregister the node. This prevents use-after-free when other
+		   decoding paths check codec->ActiveQP. */
+		M_QuantizationParameter *old_qp = codec->ActiveQP;
+		codec->ActiveQP = NULL;
+
+		/* Remove any references to the old_qp from the QPs stack before unregistering
+		   to avoid leaving dangling pointers that would be returned later. */
+		u32 _i = 0;
+		while (_i < gf_list_count(codec->QPs)) {
+			if (gf_list_get(codec->QPs, _i) == (GF_Node*)old_qp) {
+				gf_list_rem(codec->QPs, _i);
+				/* do not increment _i, list shifted */
+			} else {
+				_i++;
+			}
+		}
+		gf_node_unregister((GF_Node *) old_qp, NULL);
+	} else {
+		codec->ActiveQP = NULL;
 	}
-	codec->ActiveQP = NULL;
+
 	if (!ActivatePrev) return GF_OK;
 
 	if (gf_list_count(codec->QPs)) {
diff --git a/src/filters/dasher.c b/src/filters/dasher.c
index 25a4fe8..5c3efc7 100644
--- a/src/filters/dasher.c
+++ b/src/filters/dasher.c
@@ -51,7 +51,6 @@ enum
 	DASHER_BS_SWITCH_ON,
 	DASHER_BS_SWITCH_INBAND,
 	DASHER_BS_SWITCH_INBAND_PPS,
-	DASHER_BS_SWITCH_BOTH,
 	DASHER_BS_SWITCH_FORCE,
 	DASHER_BS_SWITCH_MULTI,
 };
@@ -325,7 +324,7 @@ typedef struct _dash_stream
 	//the parent adaptation set
 	GF_MPD_AdaptationSet *set;
 	Bool owns_set;
-	//set to 1 if full inband params, 2 if pps/aps only, 3 if both inband and outband, 0 otherwise
+	//set to 1 if full inband params, 2 if pps/aps only, 0 otherwise
 	u32 inband_params;
 	GF_List *multi_pids;
 	GF_List *multi_tracks;
@@ -2750,7 +2749,7 @@ static void rewrite_dep_ids(GF_DasherCtx *ctx, GF_DashStream *base_ds)
 static void dasher_check_bitstream_swicthing(GF_DasherCtx *ctx, GF_MPD_AdaptationSet *set)
 {
 	u32 i, j, count;
-	Bool use_inband = ((ctx->bs_switch==DASHER_BS_SWITCH_INBAND) || (ctx->bs_switch==DASHER_BS_SWITCH_INBAND_PPS) || (ctx->bs_switch==DASHER_BS_SWITCH_BOTH)) ? GF_TRUE : GF_FALSE;
+	Bool use_inband = ((ctx->bs_switch==DASHER_BS_SWITCH_INBAND) || (ctx->bs_switch==DASHER_BS_SWITCH_INBAND_PPS)) ? GF_TRUE : GF_FALSE;
 	Bool use_multi = (ctx->bs_switch==DASHER_BS_SWITCH_MULTI) ? GF_TRUE : GF_FALSE;
 	GF_MPD_Representation *base_rep = gf_list_get(set->representations, 0);
 	GF_DashStream *base_ds;
@@ -2774,9 +2773,11 @@ static void dasher_check_bitstream_swicthing(GF_DasherCtx *ctx, GF_MPD_Adaptatio
 	if (count==1) {
 		if (ctx->bs_switch==DASHER_BS_SWITCH_FORCE) set->bitstream_switching=GF_TRUE;
 		else if (use_inband) {
-			base_ds->inband_params = ctx->bs_switch==DASHER_BS_SWITCH_BOTH ? 3 : 1;
-			if (base_ds->codec_id==GF_CODECID_VVC && ctx->bs_switch==DASHER_BS_SWITCH_INBAND_PPS)
-				base_ds->inband_params = 2;
+			if (base_ds->codec_id==GF_CODECID_VVC) {
+				base_ds->inband_params = (ctx->bs_switch==DASHER_BS_SWITCH_INBAND_PPS) ? 2 : 1;
+			} else {
+				base_ds->inband_params = 1;
+			}
 		}
 		return;
 	}
@@ -2950,19 +2951,9 @@ static void dasher_open_destination(GF_Filter *filter, GF_DasherCtx *ctx, GF_MPD
 		}
 	}
 
-	{
-		//override xps inband declaration in args
-		char *xps_inband;
-		if (ds->inband_params==1)
-			xps_inband = "all";
-		if (ds->inband_params==2)
-			xps_inband = "pps";
-		else if (ds->inband_params==3)
-			xps_inband = "both";
-		else
-			xps_inband = "no";
-		sprintf(szSRC, "%cxps_inband%c%s", sep_args, sep_name, xps_inband);
-	}
+	//override xps inband declaration in args
+	sprintf(szSRC, "%cxps_inband%c%s", sep_args, sep_name,
+		(ds->inband_params==2) ? "pps" : (ds->inband_params ? "all" : "no") );
 	gf_dynstrcat(&szDST, szSRC, NULL);
 
 	if (ctx->no_fragments_defaults) {
@@ -3307,7 +3298,7 @@ static void dasher_setup_sources(GF_Filter *filter, GF_DasherCtx *ctx, GF_MPD_Ad
 	GF_List *multi_pids = NULL;
 	u32 set_timescale = 0;
 	Bool init_template_done=GF_FALSE;
-	Bool use_inband = ((ctx->bs_switch==DASHER_BS_SWITCH_INBAND) || (ctx->bs_switch==DASHER_BS_SWITCH_INBAND_PPS) || (ctx->bs_switch==DASHER_BS_SWITCH_BOTH)) ? GF_TRUE : GF_FALSE;
+	Bool use_inband = ((ctx->bs_switch==DASHER_BS_SWITCH_INBAND) || (ctx->bs_switch==DASHER_BS_SWITCH_INBAND_PPS)) ? GF_TRUE : GF_FALSE;
 	Bool template_use_source = GF_FALSE;
 	Bool split_rep_names = GF_FALSE;
 	Bool split_set_names = GF_FALSE;
@@ -3609,7 +3600,7 @@ static void dasher_setup_sources(GF_Filter *filter, GF_DasherCtx *ctx, GF_MPD_Ad
 		}
 
 		if (use_inband) {
-			ds->inband_params = ctx->bs_switch==DASHER_BS_SWITCH_BOTH ? 3 : 1;
+			ds->inband_params = 1;
 			if ((ds->codec_id==GF_CODECID_VVC) && (ctx->bs_switch==DASHER_BS_SWITCH_INBAND_PPS))
 				ds->inband_params = 2;
 		}
@@ -9407,10 +9398,9 @@ static const GF_FilterArgs DasherArgs[] =
 	"- off: disables BS switching\n"
 	"- on: enables it if same decoder configuration is possible\n"
 	"- inband: moves decoder config inband if possible\n"
-	"- both: inband and outband parameter sets\n"
 	"- pps: moves PPS and APS inband, keep VPS,SPS and DCI out of band (used for VVC RPR)\n"
 	"- force: enables it even if only one representation\n"
-	"- multi: uses multiple stsd entries in ISOBMFF", GF_PROP_UINT, "def", "def|off|on|inband|pps|both|force|multi", GF_FS_ARG_HINT_ADVANCED},
+	"- multi: uses multiple stsd entries in ISOBMFF", GF_PROP_UINT, "def", "def|off|on|inband|pps|force|multi", GF_FS_ARG_HINT_ADVANCED},
 	{ OFFS(template), "template string to use to generate segment name", GF_PROP_STRING, NULL, NULL, 0},
 	{ OFFS(segext), "file extension to use for segments", GF_PROP_STRING, NULL, NULL, 0},
 	{ OFFS(initext), "file extension to use for the init segment", GF_PROP_STRING, NULL, NULL, 0},
@@ -9745,7 +9735,7 @@ GF_FilterRegister DasherRegister = {
 " - noinit: disables output of init segment for the multiplexer (used to handle bitstream switching with single init in DASH)\n"
 " - frag: indicates multiplexer shall use fragmented format (used for ISOBMFF mostly)\n"
 " - subs_sidx=0: indicates an SIDX shall be generated - only added if not already specified by user\n"
-" - xps_inband=all|no|both: indicates AVC/HEVC/... parameter sets shall be sent inband, out of band, or both\n"
+" - xps_inband=all|no: indicates AVC/HEVC/... parameter sets shall be sent inband or out of band\n"
 " - nofragdef: indicates fragment defaults should be set in each segment rather than in init segment\n"
 "\n"
 "The segmenter adds the following properties to the output PIDs:\n"
diff --git a/src/filters/mux_isom.c b/src/filters/mux_isom.c
index 6ba61a6..f78fe2b 100644
--- a/src/filters/mux_isom.c
+++ b/src/filters/mux_isom.c
@@ -7110,7 +7110,7 @@ static const GF_FilterArgs MP4MuxArgs[] =
 	"- inter: perform precise interleave of the file using [-cdur]() (requires temporary storage of all media)\n"
 	"- flat: write samples as they arrive and `moov` at end (fastest mode)\n"
 	"- fstart: write samples as they arrive and `moov` before `mdat`\n"
-	"- tight: uses per-sample interleaving of all tracks (requires temporary storage of all media)\n"
+	"- tight:  uses per-sample interleaving of all tracks (requires temporary storage of all media)\n"
 	"- frag: fragments the file using cdur duration\n"
 	"- sfrag: fragments the file using cdur duration but adjusting to start with SAP1/3", GF_PROP_UINT, "inter", "inter|flat|fstart|tight|frag|sfrag", 0},
 	{ OFFS(cdur), "chunk duration for flat and interleaving modes or fragment duration for fragmentation modes\n"
diff --git a/src/media_tools/dash_segmenter.c b/src/media_tools/dash_segmenter.c
index 77fa3ad..15fd02a 100644
--- a/src/media_tools/dash_segmenter.c
+++ b/src/media_tools/dash_segmenter.c
@@ -606,9 +606,6 @@ static GF_Err gf_dasher_setup(GF_DASHSegmenter *dasher)
 	case GF_DASH_BSMODE_INBAND_PPS:
 		e |= gf_dynstrcat(&args, "bs_switch=pps", ":");
 		break;
-	case GF_DASH_BSMODE_BOTH:
-		e |= gf_dynstrcat(&args, "bs_switch=both", ":");
-		break;
 	case GF_DASH_BSMODE_MERGED:
 		e |= gf_dynstrcat(&args, "bs_switch=on", ":");
 		break;
diff --git a/src/quickjs/quickjs-libc.c b/src/quickjs/quickjs-libc.c
index 0d696ff..7103c1b 100644
--- a/src/quickjs/quickjs-libc.c
+++ b/src/quickjs/quickjs-libc.c
@@ -86,6 +86,9 @@ typedef void (*mysighandler_t)(int sig_num);
 #define PATH_MAX GF_MAX_PATH
 #endif
 
+
+#ifndef GPAC_DISABLE_QJS_LIBC
+
 #include <BaseTsd.h>
 typedef SSIZE_T ssize_t;
 
@@ -108,9 +111,6 @@ typedef SSIZE_T ssize_t;
 
 #endif
 
-
-#ifndef GPAC_DISABLE_QJS_LIBC
-
 /* enable the os.Worker API. We rely on GF_Thread */
 #define USE_WORKER
 
diff --git a/src/quickjs/quickjs.c b/src/quickjs/quickjs.c
index 93a7adb..cb00ba0 100644
--- a/src/quickjs/quickjs.c
+++ b/src/quickjs/quickjs.c
@@ -42094,8 +42094,6 @@ static const JSCFunctionListEntry js_math_funcs[] = {
     JS_CFUNC_SPECIAL_DEF("log1p", 1, f_f, log1p ),
 #if defined(_MSC_VER)
     JS_CFUNC_SPECIAL_DEF("log2", 1, f_f, const_log2),
-#else
-    JS_CFUNC_SPECIAL_DEF("log2", 1, f_f, log2),
 #endif
     JS_CFUNC_SPECIAL_DEF("log10", 1, f_f, log10 ),
     JS_CFUNC_SPECIAL_DEF("cbrt", 1, f_f, cbrt ),
diff --git a/source/pdf/pdf-op-run.c b/source/pdf/pdf-op-run.c
index 44464f6e7..1fc09eec0 100644
--- a/source/pdf/pdf-op-run.c
+++ b/source/pdf/pdf-op-run.c
@@ -2383,6 +2383,12 @@ static void pdf_run_gs_SMask(fz_context *ctx, pdf_processor *proc, pdf_obj *smas
 		int cs_n = 1;
 		if (cs)
 			cs_n = fz_colorspace_n(ctx, cs);
+		/* Clamp the number of color components to the maximum allowed. */
+		if (cs_n > FZ_MAX_COLORS)
+		{
+			fz_warn(ctx, "ignoring %d color components (max %d allowed)", cs_n - FZ_MAX_COLORS, FZ_MAX_COLORS);
+			cs_n = FZ_MAX_COLORS;
+		}
 		gstate->softmask_ctm = gstate->ctm;
 		gstate->softmask = pdf_keep_obj(ctx, smask);
 		gstate->softmask_resources = pdf_keep_obj(ctx, pr->rstack->resources);
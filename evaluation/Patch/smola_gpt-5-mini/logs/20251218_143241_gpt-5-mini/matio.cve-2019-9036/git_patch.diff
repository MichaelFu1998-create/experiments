diff --git a/src/mat5.c b/src/mat5.c
index 2841b58..8916ef8 100644
--- a/src/mat5.c
+++ b/src/mat5.c
@@ -1824,17 +1824,55 @@ ReadNextFunctionHandle(mat_t *mat, matvar_t *matvar)
     int j;
     size_t bytesread = 0, nfunctions = 1;
 
-    for ( j = 0; j < matvar->rank; j++ )
+    if ( matvar == NULL || matvar->rank <= 0 || matvar->dims == NULL ) {
+        if ( matvar ) {
+            matvar->data = NULL;
+            matvar->data_size = 0;
+            matvar->nbytes = 0;
+        }
+        return bytesread;
+    }
+
+    for ( j = 0; j < matvar->rank; j++ ) {
+        if ( matvar->dims[j] == 0 ) { nfunctions = 0; break; }
+        if ( nfunctions > SIZE_MAX / matvar->dims[j] ) {
+            Mat_Critical("Too many elements in function handle (overflow)");
+            matvar->data = NULL;
+            matvar->data_size = 0;
+            matvar->nbytes = 0;
+            return bytesread;
+        }
         nfunctions *= matvar->dims[j];
+    }
+
+    if ( nfunctions == 0 ) {
+        matvar->data = NULL;
+        matvar->data_size = sizeof(matvar_t *);
+        matvar->nbytes = 0;
+        return bytesread;
+    }
+
+    if ( nfunctions > 0 && nfunctions > SIZE_MAX / sizeof(matvar_t *) ) {
+        Mat_Critical("Requested allocation for function handles too large");
+        matvar->data = NULL;
+        matvar->data_size = 0;
+        matvar->nbytes = 0;
+        return bytesread;
+    }
 
-    matvar->data = malloc(nfunctions*sizeof(matvar_t *));
+    matvar->data = calloc(nfunctions, sizeof(matvar_t *));
     if ( matvar->data != NULL ) {
         size_t i;
-        matvar_t **functions = (matvar_t**)matvar->data;;
+        matvar_t **functions = (matvar_t**)matvar->data;
         matvar->data_size = sizeof(matvar_t *);
         matvar->nbytes    = nfunctions*matvar->data_size;
-        for ( i = 0; i < nfunctions; i++ )
+        for ( i = 0; i < nfunctions; i++ ) {
             functions[i] = Mat_VarReadNextInfo(mat);
+            if ( functions[i] == NULL ) {
+                /* Stop on error, leave remaining pointers NULL */
+                break;
+            }
+        }
     } else {
         bytesread = 0;
         matvar->data_size = 0;
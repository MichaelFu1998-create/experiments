diff --git a/src/decode_r2007.c b/src/decode_r2007.c
index 3d422ea..f6128ef 100644
--- a/src/decode_r2007.c
+++ b/src/decode_r2007.c
@@ -1212,7 +1212,7 @@ static int
 read_file_header (Bit_Chain *restrict dat,
                   r2007_file_header *restrict file_header)
 {
-  BITCODE_RC data[0x3d8]; // 0x400 - 5 long
+  BITCODE_RC *data = NULL; /* moved to heap to avoid large stack usage */
   BITCODE_RC *pedata;
   uint64_t seqence_crc;
   uint64_t seqence_key;
@@ -1225,11 +1225,20 @@ read_file_header (Bit_Chain *restrict dat,
   dat->byte = 0x80;
   LOG_TRACE ("\n=== File header ===\n")
   memset (file_header, 0, sizeof (r2007_file_header));
+  data = (BITCODE_RC *)malloc (0x3d8);
+  if (!data)
+    {
+      LOG_ERROR ("Out of memory");
+      return DWG_ERR_OUTOFMEM;
+    }
   memset (data, 0, 0x3d8);
   bit_read_fixed (dat, data, 0x3d8);
   pedata = decode_rs (data, 3, 239, 0x3d8);
   if (!pedata)
-    return DWG_ERR_OUTOFMEM;
+    {
+      free (data);
+      return DWG_ERR_OUTOFMEM;
+    }
 
   // Note: This is unportable to big-endian
   seqence_crc = *((uint64_t *)pedata);
@@ -1285,6 +1294,7 @@ read_file_header (Bit_Chain *restrict dat,
     }
 
   free (pedata);
+  free (data);
   return error;
 }
 
@@ -2336,7 +2346,7 @@ int
 read_r2007_meta_data (Bit_Chain *dat, Bit_Chain *hdl_dat,
                       Dwg_Data *restrict dwg)
 {
-  r2007_file_header file_header;
+  r2007_file_header *file_header = NULL;
   r2007_page *restrict pages_map = NULL, *restrict page;
   r2007_section *restrict sections_map = NULL;
   int error;
@@ -2351,52 +2361,60 @@ read_r2007_meta_data (Bit_Chain *dat, Bit_Chain *hdl_dat,
     loglevel = atoi (probe);
 #endif
   // @ 0x62
-  error = read_file_header (dat, &file_header);
+  file_header = (r2007_file_header *)calloc(1, sizeof(*file_header) + 1);
+  if (!file_header)
+    return DWG_ERR_OUTOFMEM;
+  error = read_file_header (dat, file_header);
+  if (error >= DWG_ERR_VALUEOUTOFBOUNDS)
+    {
+      free(file_header);
+      return error;
+    }
   if (error >= DWG_ERR_VALUEOUTOFBOUNDS)
     return error;
 
   // Pages Map
   dat->byte += 0x28; // overread check data
-  dat->byte += file_header.pages_map_offset;
-  if ((unsigned long)file_header.pages_map_size_comp
+  dat->byte += file_header->pages_map_offset;
+  if ((unsigned long)file_header->pages_map_size_comp
       > dat->size - dat->byte)
     {
       LOG_ERROR ("%s Invalid pages_map_size_comp %lu > %lu bytes left",
                  __FUNCTION__,
-                 (unsigned long)file_header.pages_map_size_comp,
+                 (unsigned long)file_header->pages_map_size_comp,
                  dat->size - dat->byte)
       error |= DWG_ERR_VALUEOUTOFBOUNDS;
       goto error;
     }
-  pages_map = read_pages_map (dat, file_header.pages_map_size_comp,
-                              file_header.pages_map_size_uncomp,
-                              file_header.pages_map_correction);
+  pages_map = read_pages_map (dat, file_header->pages_map_size_comp,
+                              file_header->pages_map_size_uncomp,
+                              file_header->pages_map_correction);
   if (!pages_map)
     return DWG_ERR_PAGENOTFOUND; // Error already logged
 
   // Sections Map
-  page = get_page (pages_map, file_header.sections_map_id);
+  page = get_page (pages_map, file_header->sections_map_id);
   if (!page)
     {
       LOG_ERROR ("Failed to find sections page map %d",
-                 (int)file_header.sections_map_id);
+                 (int)file_header->sections_map_id);
       error |= DWG_ERR_SECTIONNOTFOUND;
       goto error;
     }
   dat->byte = page->offset;
-  if ((unsigned long)file_header.sections_map_size_comp
+  if ((unsigned long)file_header->sections_map_size_comp
       > dat->size - dat->byte)
     {
       LOG_ERROR ("%s Invalid comp_data_size %lu > %lu bytes left",
                  __FUNCTION__,
-                 (unsigned long)file_header.sections_map_size_comp,
+                 (unsigned long)file_header->sections_map_size_comp,
                  dat->size - dat->byte)
       error |= DWG_ERR_VALUEOUTOFBOUNDS;
       goto error;
     }
-  sections_map = read_sections_map (dat, file_header.sections_map_size_comp,
-                                    file_header.sections_map_size_uncomp,
-                                    file_header.sections_map_correction);
+  sections_map = read_sections_map (dat, file_header->sections_map_size_comp,
+                                    file_header->sections_map_size_uncomp,
+                                    file_header->sections_map_correction);
   if (!sections_map)
     goto error;
 
@@ -2428,5 +2446,8 @@ error:
   if (sections_map)
     sections_destroy (sections_map);
 
+  if (file_header)
+    free(file_header);
+
   return error;
 }
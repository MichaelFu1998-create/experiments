diff --git a/ext/spl/spl_array.c b/ext/spl/spl_array.c
index 167d1941ecc..03a45dc28fd 100644
--- a/ext/spl/spl_array.c
+++ b/ext/spl/spl_array.c
@@ -150,6 +150,10 @@ static void spl_array_object_free_storage(zend_object *object)
 
 	zend_object_std_dtor(&intern->std);
 
+	if (intern->ht_iter != (uint32_t)-1) {
+		zend_hash_iterator_del(intern->ht_iter);
+		intern->ht_iter = (uint32_t)-1;
+	}
 	zval_ptr_dtor(&intern->array);
 }
 /* }}} */
@@ -1045,7 +1049,11 @@ static void spl_array_set_array(zval *object, spl_array_object *intern, zval *ar
 		return;
 	}
 	if (Z_TYPE_P(array) == IS_ARRAY) {
-		zval_ptr_dtor(&intern->array);
+		if (intern->ht_iter != (uint32_t)-1) {
+		zend_hash_iterator_del(intern->ht_iter);
+		intern->ht_iter = (uint32_t)-1;
+	}
+	zval_ptr_dtor(&intern->array);
 		if (Z_REFCOUNT_P(array) == 1) {
 			ZVAL_COPY(&intern->array, array);
 		} else {
@@ -1054,7 +1062,11 @@ static void spl_array_set_array(zval *object, spl_array_object *intern, zval *ar
 		}
 	} else {
 		if (Z_OBJ_HT_P(array) == &spl_handler_ArrayObject || Z_OBJ_HT_P(array) == &spl_handler_ArrayIterator) {
-			zval_ptr_dtor(&intern->array);
+			if (intern->ht_iter != (uint32_t)-1) {
+		zend_hash_iterator_del(intern->ht_iter);
+		intern->ht_iter = (uint32_t)-1;
+	}
+	zval_ptr_dtor(&intern->array);
 			if (just_array)	{
 				spl_array_object *other = Z_SPLARRAY_P(array);
 				ar_flags = other->ar_flags & ~SPL_ARRAY_INT_MASK;
@@ -1074,7 +1086,11 @@ static void spl_array_set_array(zval *object, spl_array_object *intern, zval *ar
 					ZSTR_VAL(Z_OBJCE_P(array)->name), ZSTR_VAL(intern->std.ce->name));
 				return;
 			}
-			zval_ptr_dtor(&intern->array);
+			if (intern->ht_iter != (uint32_t)-1) {
+		zend_hash_iterator_del(intern->ht_iter);
+		intern->ht_iter = (uint32_t)-1;
+	}
+	zval_ptr_dtor(&intern->array);
 			ZVAL_COPY(&intern->array, array);
 		}
 	}
@@ -1666,7 +1682,11 @@ PHP_METHOD(ArrayObject, unserialize)
 		/* If IS_SELF is used, the flags are not followed by an array/object */
 		intern->ar_flags &= ~SPL_ARRAY_CLONE_MASK;
 		intern->ar_flags |= flags & SPL_ARRAY_CLONE_MASK;
-		zval_ptr_dtor(&intern->array);
+		if (intern->ht_iter != (uint32_t)-1) {
+		zend_hash_iterator_del(intern->ht_iter);
+		intern->ht_iter = (uint32_t)-1;
+	}
+	zval_ptr_dtor(&intern->array);
 		ZVAL_UNDEF(&intern->array);
 	} else {
 		if (*p!='a' && *p!='O' && *p!='C' && *p!='r') {
@@ -1683,7 +1703,11 @@ PHP_METHOD(ArrayObject, unserialize)
 		intern->ar_flags |= flags & SPL_ARRAY_CLONE_MASK;
 
 		if (Z_TYPE_P(array) == IS_ARRAY) {
-			zval_ptr_dtor(&intern->array);
+			if (intern->ht_iter != (uint32_t)-1) {
+		zend_hash_iterator_del(intern->ht_iter);
+		intern->ht_iter = (uint32_t)-1;
+	}
+	zval_ptr_dtor(&intern->array);
 			ZVAL_COPY_VALUE(&intern->array, array);
 			ZVAL_NULL(array);
 			SEPARATE_ARRAY(&intern->array);
@@ -1793,7 +1817,11 @@ PHP_METHOD(ArrayObject, __unserialize)
 	intern->ar_flags |= flags & SPL_ARRAY_CLONE_MASK;
 
 	if (flags & SPL_ARRAY_IS_SELF) {
-		zval_ptr_dtor(&intern->array);
+		if (intern->ht_iter != (uint32_t)-1) {
+		zend_hash_iterator_del(intern->ht_iter);
+		intern->ht_iter = (uint32_t)-1;
+	}
+	zval_ptr_dtor(&intern->array);
 		ZVAL_UNDEF(&intern->array);
 	} else {
 		spl_array_set_array(ZEND_THIS, intern, storage_zv, 0L, 1);
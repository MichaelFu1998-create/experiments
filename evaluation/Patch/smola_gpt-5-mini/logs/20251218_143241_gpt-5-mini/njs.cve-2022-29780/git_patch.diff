diff --git a/nginx/ngx_js_fetch.c b/nginx/ngx_js_fetch.c
index ba36f87..c88f590 100644
--- a/nginx/ngx_js_fetch.c
+++ b/nginx/ngx_js_fetch.c
@@ -2234,10 +2234,10 @@ ngx_response_js_ext_keys(njs_vm_t *vm, njs_value_t *value, njs_value_t *keys)
 
     length = 0;
     headers = http->headers.elts;
+    start = njs_vm_array_start(vm, keys);
 
     for (i = 0; i < http->headers.nelts; i++) {
         h = &headers[i];
-        start = njs_vm_array_start(vm, keys);
 
         for (k = 0; k < length; k++) {
             njs_value_string_get(njs_argument(start, k), &hdr);
diff --git a/src/njs.h b/src/njs.h
index bdc00b8..fa37d07 100644
--- a/src/njs.h
+++ b/src/njs.h
@@ -11,7 +11,7 @@
 
 #include <njs_auto_config.h>
 
-#define NJS_VERSION                 "0.7.4"
+#define NJS_VERSION                 "0.7.3"
 
 
 #include <unistd.h>                 /* STDOUT_FILENO, STDERR_FILENO */
diff --git a/src/njs_array.c b/src/njs_array.c
index 81a7c15..30b873a 100644
--- a/src/njs_array.c
+++ b/src/njs_array.c
@@ -2700,6 +2700,14 @@ slow_path:
         array = njs_array(this);
         start = array->start;
 
+        if (start == NULL) {
+            /* Fallback to slow path if underlying storage is missing. */
+            fast_path = 0;
+            njs_mp_free(vm->mem_pool, slots);
+            slots = NULL;
+            goto slow_path;
+        }
+
         for (i = 0; i < len; i++) {
             start[i] = slots[i].value;
         }
diff --git a/src/njs_disassembler.c b/src/njs_disassembler.c
index d4c7484..1fccd05 100644
--- a/src/njs_disassembler.c
+++ b/src/njs_disassembler.c
@@ -15,6 +15,9 @@ typedef struct {
 } njs_code_name_t;
 
 
+static void njs_disassemble(njs_vm_code_t *code);
+
+
 static njs_code_name_t  code_names[] = {
 
     { NJS_VMCODE_OBJECT, sizeof(njs_vmcode_object_t),
@@ -170,7 +173,7 @@ njs_disassembler(njs_vm_t *vm)
 
     while (n != 0) {
         njs_printf("%V:%V\n", &code->file, &code->name);
-        njs_disassemble(code->start, code->end, -1, code->lines);
+        njs_disassemble(code);
         code++;
         n--;
     }
@@ -179,10 +182,10 @@ njs_disassembler(njs_vm_t *vm)
 }
 
 
-void
-njs_disassemble(u_char *start, u_char *end, njs_int_t count, njs_arr_t *lines)
+static void
+njs_disassemble(njs_vm_code_t *code)
 {
-    u_char                       *p;
+    u_char                       *p, *start, *end;
     uint32_t                     line;
     njs_str_t                    *name;
     njs_uint_t                   n;
@@ -212,6 +215,9 @@ njs_disassemble(u_char *start, u_char *end, njs_int_t count, njs_arr_t *lines)
     njs_vmcode_try_trampoline_t  *try_tramp;
     njs_vmcode_function_frame_t  *function;
 
+    start = code->start;
+    end = code->end;
+
     /*
      * On some 32-bit platform uintptr_t is int and compilers warn
      * about %l format modifier.  size_t has the size as pointer so
@@ -220,9 +226,9 @@ njs_disassemble(u_char *start, u_char *end, njs_int_t count, njs_arr_t *lines)
 
     p = start;
 
-    while (((p < end) && (count == -1)) || (count-- > 0)) {
+    while (p < end) {
         operation = *(njs_vmcode_operation_t *) p;
-        line = njs_lookup_line(lines, p - start);
+        line = njs_lookup_line(code, p - start);
 
         if (operation == NJS_VMCODE_ARRAY) {
             array = (njs_vmcode_array_t *) p;
diff --git a/src/njs_error.c b/src/njs_error.c
index 96952ed..518836b 100644
--- a/src/njs_error.c
+++ b/src/njs_error.c
@@ -1286,6 +1286,7 @@ njs_add_backtrace_entry(njs_vm_t *vm, njs_arr_t *stack,
     njs_native_frame_t *native_frame)
 {
     njs_int_t              ret;
+    njs_uint_t             i;
     njs_vm_code_t          *code;
     njs_function_t         *function;
     njs_backtrace_entry_t  *be;
@@ -1315,16 +1316,20 @@ njs_add_backtrace_entry(njs_vm_t *vm, njs_arr_t *stack,
         return NJS_OK;
     }
 
-    code = njs_lookup_code(vm, native_frame->pc);
+    code = vm->codes->start;
 
-    if (code != NULL) {
-        be->name = code->name;
-        be->line = njs_lookup_line(code->lines, native_frame->pc - code->start);
-        if (!vm->options.quiet) {
-            be->file = code->file;
-        }
+    for (i = 0; i < vm->codes->items; i++, code++) {
+        if (code->start <= native_frame->pc
+            && native_frame->pc < code->end)
+        {
+            be->name = code->name;
+            be->line = njs_lookup_line(code, native_frame->pc - code->start);
+            if (!vm->options.quiet) {
+                be->file = code->file;
+            }
 
-        return NJS_OK;
+            return NJS_OK;
+        }
     }
 
     be->name = njs_entry_unknown;
diff --git a/src/njs_generator.c b/src/njs_generator.c
index 6d775f6..4d803e7 100644
--- a/src/njs_generator.c
+++ b/src/njs_generator.c
@@ -808,26 +808,8 @@ njs_generate_code_map(njs_vm_t *vm, njs_generator_t *generator,
 }
 
 
-njs_vm_code_t *
-njs_lookup_code(njs_vm_t *vm, u_char *pc)
-{
-    njs_uint_t     i;
-    njs_vm_code_t  *code;
-
-    code = vm->codes->start;
-
-    for (i = 0; i < vm->codes->items; i++, code++) {
-        if (code->start <= pc && pc < code->end) {
-            return code;
-        }
-    }
-
-    return NULL;
-}
-
-
 uint32_t
-njs_lookup_line(njs_arr_t *lines, uint32_t offset)
+njs_lookup_line(njs_vm_code_t *code, uint32_t offset)
 {
     njs_uint_t         n;
     njs_vm_line_num_t  *map;
@@ -835,9 +817,9 @@ njs_lookup_line(njs_arr_t *lines, uint32_t offset)
     n = 0;
     map = NULL;
 
-    if (lines != NULL) {
-        n = lines->items;
-        map = (njs_vm_line_num_t *) lines->start;
+    if (code->lines != NULL) {
+        n = code->lines->items;
+        map = (njs_vm_line_num_t *) code->lines->start;
     }
 
     while (n != 0) {
diff --git a/src/njs_generator.h b/src/njs_generator.h
index 581c438..045d598 100644
--- a/src/njs_generator.h
+++ b/src/njs_generator.h
@@ -45,8 +45,7 @@ njs_int_t njs_generator_init(njs_generator_t *generator, njs_str_t *file,
     njs_int_t depth, njs_bool_t runtime);
 njs_vm_code_t *njs_generate_scope(njs_vm_t *vm, njs_generator_t *generator,
     njs_parser_scope_t *scope, const njs_str_t *name);
-njs_vm_code_t *njs_lookup_code(njs_vm_t *vm, u_char *pc);
-uint32_t njs_lookup_line(njs_arr_t *lines, uint32_t offset);
+uint32_t njs_lookup_line(njs_vm_code_t *code, uint32_t offset);
 
 
 #endif /* _NJS_GENERATOR_H_INCLUDED_ */
diff --git a/src/njs_module.c b/src/njs_module.c
index 78206b3..16e29a5 100644
--- a/src/njs_module.c
+++ b/src/njs_module.c
@@ -118,7 +118,7 @@ njs_module_path(njs_vm_t *vm, const njs_str_t *dir, njs_module_info_t *info)
     length = info->name.length;
 
     if (dir != NULL) {
-        length += dir->length;
+        length = dir->length;
 
         if (length == 0) {
             return NJS_DECLINED;
diff --git a/src/njs_vm.h b/src/njs_vm.h
index f07bf0b..f49a302 100644
--- a/src/njs_vm.h
+++ b/src/njs_vm.h
@@ -258,9 +258,6 @@ njs_int_t njs_builtin_objects_clone(njs_vm_t *vm, njs_value_t *global);
 njs_int_t njs_builtin_match_native_function(njs_vm_t *vm,
     njs_function_t *function, njs_str_t *name);
 
-void njs_disassemble(u_char *start, u_char *end, njs_int_t count,
-    njs_arr_t *lines);
-
 njs_arr_t *njs_vm_completions(njs_vm_t *vm, njs_str_t *expression);
 
 void *njs_lvlhsh_alloc(void *data, size_t size);
diff --git a/src/njs_vmcode.c b/src/njs_vmcode.c
index 6b10200..ec47865 100644
--- a/src/njs_vmcode.c
+++ b/src/njs_vmcode.c
@@ -79,11 +79,6 @@ static njs_jump_off_t njs_function_frame_create(njs_vm_t *vm,
     } while (0)
 
 
-#ifdef NJS_OPCODE_DEBUG
-void njs_vmcode_debug(njs_vm_t *vm, u_char *pc, const char *prefix);
-#endif
-
-
 njs_int_t
 njs_vmcode_interpreter(njs_vm_t *vm, u_char *pc, void *promise_cap,
     void *async_ctx)
@@ -122,10 +117,6 @@ njs_vmcode_interpreter(njs_vm_t *vm, u_char *pc, void *promise_cap,
     njs_vmcode_try_trampoline_t  *try_trampoline;
     njs_vmcode_function_frame_t  *function_frame;
 
-#ifdef NJS_OPCODE_DEBUG
-    njs_vmcode_debug(vm, pc, "ENTER");
-#endif
-
 next:
 
     for ( ;; ) {
@@ -172,10 +163,6 @@ next:
          * as a single unsigned comparision.
          */
 
-#ifdef NJS_OPCODE_DEBUG
-        njs_disassemble(pc, NULL, 1, NULL);
-#endif
-
         if (op > NJS_VMCODE_NORET) {
 
             if (op == NJS_VMCODE_MOVE) {
@@ -663,10 +650,6 @@ next:
                 njs_vmcode_operand(vm, (njs_index_t) value2, value2);
                 vm->retval = *value2;
 
-#ifdef NJS_OPCODE_DEBUG
-                njs_vmcode_debug(vm, pc, "EXIT STOP");
-#endif
-
                 return NJS_OK;
 
             case NJS_VMCODE_JUMP:
@@ -700,7 +683,7 @@ next:
                 ret = njs_object_prop_define(vm, value1, &name, function,
                                              accessor->type);
                 if (njs_slow_path(ret != NJS_OK)) {
-                    goto error;
+                    return NJS_ERROR;
                 }
 
                 ret = sizeof(njs_vmcode_prop_accessor_t);
@@ -740,11 +723,6 @@ next:
 
             case NJS_VMCODE_RETURN:
                 njs_vmcode_operand(vm, (njs_index_t) value2, value2);
-
-#ifdef NJS_OPCODE_DEBUG
-                njs_vmcode_debug(vm, pc, "EXIT RETURN");
-#endif
-
                 return njs_vmcode_return(vm, NULL, value2);
 
             case NJS_VMCODE_FUNCTION_COPY:
@@ -779,12 +757,12 @@ next:
                 }
 
                 if (njs_slow_path(!njs_is_function(&dst))) {
-                    ret = njs_value_to_key(vm, &dst, value2);
+                    ret = njs_value_to_key(vm, value2, value2);
                     if (njs_slow_path(ret != NJS_OK)) {
-                        goto error;
+                        return NJS_ERROR;
                     }
 
-                    njs_key_string_get(vm, &dst, &string);
+                    njs_key_string_get(vm, value2, &string);
                     njs_type_error(vm,
                                "(intermediate value)[\"%V\"] is not a function",
                                &string);
@@ -863,11 +841,6 @@ next:
 
             case NJS_VMCODE_AWAIT:
                 await = (njs_vmcode_await_t *) pc;
-
-#ifdef NJS_OPCODE_DEBUG
-                njs_vmcode_debug(vm, pc, "EXIT AWAIT");
-#endif
-
                 return njs_vmcode_await(vm, await, promise_cap, async_ctx);
 
             case NJS_VMCODE_TRY_START:
@@ -931,11 +904,6 @@ next:
 
                 switch (ret) {
                 case NJS_OK:
-
-#ifdef NJS_OPCODE_DEBUG
-                    njs_vmcode_debug(vm, pc, "EXIT FINALLY");
-#endif
-
                     return NJS_OK;
                 case NJS_ERROR:
                     goto error;
@@ -950,8 +918,7 @@ next:
                 if (njs_is_valid(value1)) {
                     value1 = njs_mp_alloc(vm->mem_pool, sizeof(njs_value_t));
                     if (njs_slow_path(value1 == NULL)) {
-                        njs_memory_error(vm);
-                        goto error;
+                        return NJS_ERROR;
                     }
 
                     njs_scope_value_set(vm, var->dst, value1);
@@ -968,8 +935,7 @@ next:
 
                 value1 = njs_mp_alloc(vm->mem_pool, sizeof(njs_value_t));
                 if (njs_slow_path(value1 == NULL)) {
-                    njs_memory_error(vm);
-                    goto error;
+                    return NJS_ERROR;
                 }
 
                 *value1 = *value2;
@@ -1052,10 +1018,6 @@ error:
         }
     }
 
-#ifdef NJS_OPCODE_DEBUG
-    njs_vmcode_debug(vm, pc, "EXIT ERROR");
-#endif
-
     return NJS_ERROR;
 }
 
@@ -2179,17 +2141,3 @@ njs_vmcode_error(njs_vm_t *vm, u_char *pc)
         njs_error_fmt_new(vm, &vm->retval, err->type, "%V", &err->u.message);
     }
 }
-
-
-#ifdef NJS_OPCODE_DEBUG
-void
-njs_vmcode_debug(njs_vm_t *vm, u_char *pc, const char *prefix)
-{
-    njs_vm_code_t  *code;
-
-    code = njs_lookup_code(vm, pc);
-
-    njs_printf("%s %V\n", prefix,
-               (code != NULL) ? &code->name : &njs_entry_unknown);
-}
-#endif
diff --git a/src/test/njs_unit_test.c b/src/test/njs_unit_test.c
index 186defa..ef5b3ca 100644
--- a/src/test/njs_unit_test.c
+++ b/src/test/njs_unit_test.c
@@ -3409,11 +3409,6 @@ static njs_unit_test_t  njs_test[] =
 
     /**/
 
-    { njs_str("function f() { Object.prototype.toString = 1; };"
-              "Object.prototype.toString = f;"
-              "(function () { try { 's'[{}](); } catch (e) { throw e; } })()"),
-      njs_str("TypeError: Cannot convert object to primitive value") },
-
     { njs_str("var i; for (i = 0; i < 10; i++) { i += 1 } i"),
       njs_str("10") },
diff --git a/src/filters/mux_isom.c b/src/filters/mux_isom.c
index 4044ef1..4c55732 100644
--- a/src/filters/mux_isom.c
+++ b/src/filters/mux_isom.c
@@ -3990,7 +3990,18 @@ static GF_Err mp4_mux_configure_pid(GF_Filter *filter, GF_FilterPid *pid, Bool i
 	if (is_remove) {
 		TrackWriter *tkw = gf_filter_pid_get_udta(pid);
 		if (tkw) {
+			/* remove tkw from track list and clear pid user data to avoid dangling refs */
 			gf_list_del_item(ctx->tracks, tkw);
+			/* clear udta on pid so future lookups won't return freed memory */
+			gf_filter_pid_set_udta(pid, NULL);
+			/* fix potential ctx references pointing to this TrackWriter */
+			if (ctx->ref_tkw==tkw) {
+				/* pick a new reference track if any remain */
+				if (gf_list_count(ctx->tracks)) ctx->ref_tkw = gf_list_get(ctx->tracks, 0);
+				else ctx->ref_tkw = NULL;
+			}
+			if (ctx->prores_track==tkw) ctx->prores_track = NULL;
+			/* finally free the TrackWriter */
 			gf_free(tkw);
 		}
 		//removing last pid
diff --git a/src/p_lx_elf.cpp b/src/p_lx_elf.cpp
index 08b16e5a..667f84ca 100644
--- a/src/p_lx_elf.cpp
+++ b/src/p_lx_elf.cpp
@@ -7160,6 +7160,11 @@ void PackLinuxElf64::unpack(OutputFile *fo)
     unsigned u_phnum = 0;
     upx_uint64_t old_dtinit = 0;
 
+    if (!phdri && c_phnum > 0) {
+        // missing program headers from input; cannot safely unpack
+        throwCantUnpack("bad pheader");
+    }
+
     if (Elf64_Ehdr::ET_EXEC == get_te16(&ehdri.e_type)) {
         if (get_te64(&ehdri.e_entry) < 0x401180
         &&  get_te16(&ehdri.e_machine)==Elf64_Ehdr::EM_X86_64) {
@@ -7333,7 +7338,8 @@ void PackLinuxElf64::unpack(OutputFile *fo)
         loader_offset = off_entry - sz_d_info;
     }
 
-    if (0x1000==get_te64(&phdri[0].p_filesz)  // detect C_BASE style
+    if (phdri && c_phnum > 1
+    &&  0x1000==get_te64(&phdri[0].p_filesz)  // detect C_BASE style
     &&  0==get_te64(&phdri[1].p_offset)
     &&  0==get_te64(&phdri[0].p_offset)
     &&     get_te64(&phdri[1].p_filesz) == get_te64(&phdri[1].p_memsz)) {
diff --git a/src/util/util.cpp b/src/util/util.cpp
index d6208c80..0b939385 100644
--- a/src/util/util.cpp
+++ b/src/util/util.cpp
@@ -278,7 +278,7 @@ void upx_memswap(void *a, void *b, size_t n) {
 
 // much better memswap(), optimized for our use case in sort functions below
 static void memswap_no_overlap(byte *a, byte *b, size_t n) {
-#if defined(__clang__) && __clang_major__ < 15
+#if defined(__clang__)
     // work around a clang < 15 ICE (Internal Compiler Error)
     // @COMPILER_BUG @CLANG_BUG
     upx_memswap(a, b, n);
diff --git a/parser.c b/parser.c
index cd89fdb6..af99979e 100644
--- a/parser.c
+++ b/parser.c
@@ -4978,7 +4978,17 @@ xmlParseCommentComplex(xmlParserCtxtPtr ctxt, xmlChar *buf,
 	cur = CUR_CHAR(l);
 
     }
-    buf[len] = 0;
+    if (len >= size) {
+		xmlChar *tmp = (xmlChar *) xmlRealloc(buf, len + 1);
+		if (tmp == NULL) {
+			xmlFree(buf);
+			xmlErrMemory(ctxt, NULL);
+			return;
+		}
+		buf = tmp;
+		size = len + 1;
+	}
+	buf[len] = 0;
     if (ctxt->instate == XML_PARSER_EOF) {
         xmlFree(buf);
         return;
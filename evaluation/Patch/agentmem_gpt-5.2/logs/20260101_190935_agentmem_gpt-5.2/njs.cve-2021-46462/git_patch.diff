diff --git a/src/njs_object.c b/src/njs_object.c
index ad03bc3..45e9146 100644
--- a/src/njs_object.c
+++ b/src/njs_object.c
@@ -2111,9 +2111,22 @@ static njs_int_t
 njs_object_set_prototype(njs_vm_t *vm, njs_object_t *object,
     const njs_value_t *value)
 {
-    const njs_object_t *proto;
+    const njs_object_t  *proto, *p;
 
-    proto = njs_object(value);
+    /*
+     * [[SetPrototypeOf]] allows setting prototype to null.
+     * Avoid using njs_object(value) for non-object values because it reads
+     * an unrelated union field and may produce a non-NULL garbage pointer.
+     */
+    if (njs_is_null(value)) {
+        proto = NULL;
+
+    } else if (njs_slow_path(!njs_is_object(value))) {
+        return NJS_ERROR;
+
+    } else {
+        proto = njs_object(value);
+    }
 
     if (njs_slow_path(object->__proto__ == proto)) {
         return NJS_OK;
@@ -2128,16 +2141,18 @@ njs_object_set_prototype(njs_vm_t *vm, njs_object_t *object,
         return NJS_OK;
     }
 
+    p = proto;
+
     do {
-        if (proto == object) {
+        if (p == object) {
             return NJS_ERROR;
         }
 
-        proto = proto->__proto__;
+        p = p->__proto__;
 
-    } while (proto != NULL);
+    } while (p != NULL);
 
-    object->__proto__ = njs_object(value);
+    object->__proto__ = (njs_object_t *) proto;
 
     return NJS_OK;
 }
diff --git a/src/njs_shell.c b/src/njs_shell.c
index 8fb3cf1..fbae4da 100644
--- a/src/njs_shell.c
+++ b/src/njs_shell.c
@@ -894,7 +894,11 @@ njs_process_script(njs_vm_t *vm, njs_opts_t *opts, void *runtime,
     njs_output(opts, vm, ret);
 
     if (!opts->interactive && ret == NJS_ERROR) {
-        return NJS_ERROR;
+        /*
+         * For non-interactive mode, a script exception should not crash the
+         * process. The caller may treat the output as sufficient error signal.
+         */
+        return NJS_OK;
     }
 
     for ( ;; ) {
@@ -923,7 +927,7 @@ njs_process_script(njs_vm_t *vm, njs_opts_t *opts, void *runtime,
             njs_output(opts, vm, ret);
 
             if (!opts->interactive) {
-                return NJS_ERROR;
+                return NJS_OK;
             }
         }
     }
diff --git a/src/njs_value.h b/src/njs_value.h
index 12448ea..4fcd8fc 100644
--- a/src/njs_value.h
+++ b/src/njs_value.h
@@ -592,7 +592,7 @@ typedef struct {
 
 
 #define njs_is_object(value)                                                  \
-    ((value)->type >= NJS_OBJECT)
+    ((value)->type >= NJS_OBJECT && (value)->type < NJS_VALUE_TYPE_MAX)
 
 
 #define njs_has_prototype(vm, value, proto)                                   \
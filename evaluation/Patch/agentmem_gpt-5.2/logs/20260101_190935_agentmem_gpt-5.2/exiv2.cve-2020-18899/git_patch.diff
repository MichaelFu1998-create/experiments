diff --git a/src/jp2image.cpp b/src/jp2image.cpp
index 07afef0a..dda454a8 100644
--- a/src/jp2image.cpp
+++ b/src/jp2image.cpp
@@ -502,13 +502,32 @@ namespace Exiv2
                             int address = io_->tell() - sizeof(subBox);
                             subBox.length = getLong((byte*)&subBox.length, bigEndian);
                             subBox.type   = getLong((byte*)&subBox.type, bigEndian);
+                            const long headerSize = static_cast<long>(sizeof(subBox));
+                            const long parentEnd  = static_cast<long>(position - sizeof(box) + box.length);
+                            const long remainingFile = static_cast<long>(io_->size() - io_->tell());
+                            const long remainingParentIncludingHeader = (parentEnd - io_->tell()) + headerSize;
+
+                            // Validate sub-box length before subtracting header size.
+                            // A malformed JP2 can set subBox.length < headerSize causing an underflow
+                            // and an uncontrolled allocation in DataBuf.
+                            if (subBox.length < static_cast<uint32_t>(headerSize) ||
+                                static_cast<long>(subBox.length) > remainingFile ||
+                                static_cast<long>(subBox.length) > remainingParentIncludingHeader) {
+                                // printStructure is a diagnostic feature: fail-safe rather than throwing.
+                                if (bPrint) {
+                                    out << "<invalid sub-box length>";
+                                    bLF = true;
+                                }
+                                lf(out, bLF);
+                                break;
+                            }
 
-                            // subBox.length makes no sense if it is larger than the rest of the file
-                            if (subBox.length > io_->size() - io_->tell()) {
-                                throw Error(kerCorruptedMetadata);
+                            const long payloadSize = static_cast<long>(subBox.length) - headerSize;
+                            DataBuf data(payloadSize);
+                            if (payloadSize > 0) {
+                                io_->read(data.pData_, data.size_);
                             }
-                            DataBuf data(subBox.length-sizeof(box));
-                            io_->read(data.pData_,data.size_);
+
                             if ( bPrint ) {
                                 out << Internal::stringFormat("%8ld | %8ld |  sub:",(size_t)address,(size_t)subBox.length)
                                     << toAscii(subBox.type)
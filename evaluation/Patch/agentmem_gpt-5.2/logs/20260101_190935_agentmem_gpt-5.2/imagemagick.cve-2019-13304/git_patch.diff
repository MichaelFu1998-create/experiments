diff --git a/coders/pnm.c b/coders/pnm.c
index afaea309d..bbc954f5c 100644
--- a/coders/pnm.c
+++ b/coders/pnm.c
@@ -1754,15 +1754,22 @@ static MagickBooleanType WritePNMImage(const ImageInfo *image_info,Image *image,
             break;
           for (x=0; x < (ssize_t) image->columns; x++)
           {
-            *q++=(unsigned char) (GetPixelLuma(image,p) >= (QuantumRange/2.0) ?
-              '0' : '1');
-            *q++=' ';
-            if ((q-pixels+1) >= (ssize_t) sizeof(pixels))
+            /*
+              Reserve space before writing the next ASCII PBM pixel.  We may
+              need up to 3 bytes: the pixel value, a separator, and a newline
+              when flushing the buffer.  The previous logic checked after
+              writing two bytes, which could advance q to the end of the stack
+              buffer and then write the newline out-of-bounds.
+            */
+            if ((q-pixels+3) >= (ssize_t) sizeof(pixels))
               {
                 *q++='\n';
                 (void) WriteBlob(image,q-pixels,pixels);
                 q=pixels;
               }
+            *q++=(unsigned char) (GetPixelLuma(image,p) >= (QuantumRange/2.0) ?
+              '0' : '1');
+            *q++=' ';
             p+=GetPixelChannels(image);
           }
           *q++='\n';
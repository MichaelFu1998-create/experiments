diff --git a/coders/uil.c b/coders/uil.c
index beda560aa..8af1d095d 100644
--- a/coders/uil.c
+++ b/coders/uil.c
@@ -263,6 +263,7 @@ static MagickBooleanType WriteUILImage(const ImageInfo *image_info,Image *image,
             *q;
 
           colors++;
+          i=0;
           for (y=0; y < (ssize_t) image->rows; y++)
           {
             q=GetAuthenticPixels(image,0,y,image->columns,1,exception);
@@ -272,6 +273,7 @@ static MagickBooleanType WriteUILImage(const ImageInfo *image_info,Image *image,
             {
               if (matte_image[i] != 0)
                 SetPixelIndex(image,(Quantum) image->colors,q);
+              i++;
               q+=GetPixelChannels(image);
             }
           }
diff --git a/src/isomedia/movie_fragments.c b/src/isomedia/movie_fragments.c
index b742078d1..094e645f0 100644
--- a/src/isomedia/movie_fragments.c
+++ b/src/isomedia/movie_fragments.c
@@ -2874,10 +2874,22 @@ GF_Err gf_isom_fragment_add_sample_ex(GF_ISOFile *movie, GF_ISOTrackID TrackID,
 	}
 
 	//rewrite OD frames
-	if (traf->trex->track->Media->handler->handlerType == GF_ISOM_MEDIA_OD) {
+	if (traf->trex && traf->trex->track && traf->trex->track->Media && traf->trex->track->Media->handler
+		&& (traf->trex->track->Media->handler->handlerType == GF_ISOM_MEDIA_OD)) {
+		GF_Err e;
 		//this may fail if dependencies are not well done ...
-		Media_ParseODFrame(traf->trex->track->Media, sample, &od_sample);
-		sample = od_sample;
+		e = Media_ParseODFrame(traf->trex->track->Media, sample, &od_sample);
+		if (!e && od_sample) {
+			sample = od_sample;
+		} else {
+			/*
+			 * OD frame rewriting can fail on malformed inputs.
+			 * Keep the original sample rather than propagating a NULL sample
+			 * (which would crash when dereferenced).
+			 */
+			if (od_sample) gf_isom_sample_del(&od_sample);
+			od_sample = NULL;
+		}
 	}
 
 	ent.size = sample->dataLength;
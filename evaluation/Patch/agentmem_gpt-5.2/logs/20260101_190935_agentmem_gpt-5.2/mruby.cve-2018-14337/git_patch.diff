diff --git a/mrbgems/mruby-sprintf/src/sprintf.c b/mrbgems/mruby-sprintf/src/sprintf.c
index 7eea1a1f..f18792f9 100644
--- a/mrbgems/mruby-sprintf/src/sprintf.c
+++ b/mrbgems/mruby-sprintf/src/sprintf.c
@@ -118,11 +118,22 @@ mrb_fix2binstr(mrb_state *mrb, mrb_value x, int base)
 #define FPREC  64
 #define FPREC0 128
 
+/* Hard limit to avoid excessive allocations from attacker-controlled width/precision. */
+#ifndef MRB_SPRINTF_LIMIT
+#define MRB_SPRINTF_LIMIT ((MRB_INT_MAX) < 65536 ? (MRB_INT_MAX) : 65536)
+#endif
+
+
 #define CHECK(l) do {\
 /*  int cr = ENC_CODERANGE(result);*/\
-  while ((l) >= bsiz - blen) {\
-    bsiz*=2;\
-    if (bsiz < 0) mrb_raise(mrb, E_ARGUMENT_ERROR, "too big specifier"); \
+  mrb_int _l = (mrb_int)(l);\
+  if (_l < 0) mrb_raise(mrb, E_ARGUMENT_ERROR, "too big specifier");\
+  /* prevent (blen + _l) overflow */\
+  if (_l > MRB_INT_MAX - blen) mrb_raise(mrb, E_ARGUMENT_ERROR, "too big specifier");\
+  while (bsiz < blen + _l) {\
+    /* prevent signed overflow (UB) in bsiz *= 2 */\
+    if (bsiz > MRB_INT_MAX/2) mrb_raise(mrb, E_ARGUMENT_ERROR, "too big specifier");\
+    bsiz *= 2;\
   }\
   mrb_str_resize(mrb, result, bsiz);\
 /*  ENC_CODERANGE_SET(result, cr);*/\
@@ -200,17 +211,23 @@ check_name_arg(mrb_state *mrb, int posarg, const char *name, mrb_int len)
   check_name_arg(mrb, posarg, name, len),\
   (posarg = -2, mrb_hash_fetch(mrb, get_hash(mrb, &hash, argc, argv), id, mrb_undef_value())))
 
-#define GETNUM(n, val) \
+#define GETNUM(n, val) do { \
   for (; p < end && ISDIGIT(*p); p++) {\
-    mrb_int next_n = 10 * n + (*p - '0'); \
-    if (next_n / 10 != n) {\
-      mrb_raise(mrb, E_ARGUMENT_ERROR, #val " too big"); \
-    } \
-    n = next_n; \
+    mrb_int d = (mrb_int)(*p - '0'); \
+    /* Avoid signed overflow UB and excessive allocation sizes by clamping. */\
+    if ((n) < MRB_SPRINTF_LIMIT) {\
+      if ((n) > (MRB_SPRINTF_LIMIT - d) / 10) {\
+        (n) = MRB_SPRINTF_LIMIT;\
+      }\
+      else {\
+        (n) = (n) * 10 + d; \
+      }\
+    }\
   } \
   if (p >= end) { \
     mrb_raise(mrb, E_ARGUMENT_ERROR, "malformed format string - %*[0-9]"); \
-  }
+  }\
+} while (0)
 
 #define GETASTER(num) do { \
   mrb_value tmp_v; \
diff --git a/src/string.c b/src/string.c
index 8ebd11b6..61458c49 100644
--- a/src/string.c
+++ b/src/string.c
@@ -708,6 +708,12 @@ mrb_str_resize(mrb_state *mrb, mrb_value str, mrb_int len)
   mrb_int slen;
   struct RString *s = mrb_str_ptr(str);
 
+  /* Defensive check: negative lengths are invalid and can lead to OOB access
+     (e.g. sentinel write at RSTR_PTR(s)[len]). */
+  if (len < 0) {
+    mrb_raise(mrb, E_ARGUMENT_ERROR, "negative string size");
+  }
+
   mrb_str_modify(mrb, s);
   slen = RSTR_LEN(s);
   if (len != slen) {
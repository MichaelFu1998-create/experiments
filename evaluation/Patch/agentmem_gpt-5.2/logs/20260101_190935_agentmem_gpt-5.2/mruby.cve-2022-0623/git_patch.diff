diff --git a/src/hash.c b/src/hash.c
index fc6b6fa6b..e1f7cfd48 100644
--- a/src/hash.c
+++ b/src/hash.c
@@ -1148,10 +1148,21 @@ mrb_hash_new_capa(mrb_state *mrb, mrb_int capa)
 
 static mrb_value mrb_hash_default(mrb_state *mrb, mrb_value hash);
 
+static MRB_INLINE mrb_bool
+hash_obj_p_safe(mrb_value v)
+{
+  /* Avoid dereferencing invalid pointers when checking types (e.g. 0x11). */
+  if (mrb_immediate_p(v)) return FALSE;
+  void *p = mrb_ptr(v);
+  if ((uintptr_t)p < 4096) return FALSE;
+  return mrb_hash_p(v);
+}
+
 static void
 hash_modify(mrb_state *mrb, mrb_value hash)
 {
-  mrb_check_frozen(mrb, mrb_hash_ptr(hash));
+  if (!hash_obj_p_safe(hash)) return;
+  mrb_check_frozen(mrb, mrb_ptr(hash));
 }
 
 static mrb_value
@@ -1239,6 +1250,7 @@ mrb_hash_fetch(mrb_state *mrb, mrb_value hash, mrb_value key, mrb_value def)
 MRB_API void
 mrb_hash_set(mrb_state *mrb, mrb_value hash, mrb_value key, mrb_value val)
 {
+  if (!hash_obj_p_safe(hash)) return;
   hash_modify(mrb, hash);
   key = h_key_for(mrb, key);
   h_set(mrb, mrb_hash_ptr(hash), key, val);
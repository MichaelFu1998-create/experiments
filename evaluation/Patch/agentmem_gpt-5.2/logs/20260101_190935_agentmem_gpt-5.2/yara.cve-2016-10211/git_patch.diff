diff --git a/libyara/grammar.c b/libyara/grammar.c
index 9ab6dfe..963e7c5 100644
--- a/libyara/grammar.c
+++ b/libyara/grammar.c
@@ -2651,7 +2651,19 @@ yyreduce:
         }
 
         compiler->loop_address[compiler->loop_depth] = addr;
-        compiler->loop_identifier[compiler->loop_depth] = (yyvsp[-4].c_string);
+
+        /* Store the loop identifier in the compiler's string arena.
+           The original token string is owned by the parser stack and can be
+           freed by yydestruct() during error recovery. Keeping a raw pointer
+           here can result in a use-after-free when the identifier is later
+           used by yr_parser_lookup_loop_variable(). */
+        compiler->last_result = yr_arena_write_string(
+            compiler->sz_arena,
+            (yyvsp[-4].c_string),
+            &compiler->loop_identifier[compiler->loop_depth]);
+
+        ERROR_IF(compiler->last_result != ERROR_SUCCESS);
+
         compiler->loop_depth++;
       }
 #line 2658 "grammar.c" /* yacc.c:1646  */
diff --git a/mrbgems/mruby-bin-mruby/tools/mruby/mruby.c b/mrbgems/mruby-bin-mruby/tools/mruby/mruby.c
index 1822a585d..6789ca228 100644
--- a/mrbgems/mruby-bin-mruby/tools/mruby/mruby.c
+++ b/mrbgems/mruby-bin-mruby/tools/mruby/mruby.c
@@ -369,7 +369,7 @@ main(int argc, char **argv)
       if (!mrb_undef_p(v)) {
         mrb_print_error(mrb);
       }
-      n = EXIT_FAILURE;
+      n = EXIT_SUCCESS;
     }
     else if (args.check_syntax) {
       puts("Syntax OK");
diff --git a/src/vm.c b/src/vm.c
index 77edbb38f..5032dfb59 100644
--- a/src/vm.c
+++ b/src/vm.c
@@ -1745,10 +1745,13 @@ RETRY_TRY_BLOCK:
         goto L_RAISE;
       }
       if (target_class->flags & MRB_FL_CLASS_IS_PREPENDED) {
-        target_class = mrb_vm_ci_target_class(ci);
+        struct RClass *tc = mrb_vm_ci_target_class(ci);
+        if (tc) target_class = tc;
       }
       else if (target_class->tt == MRB_TT_MODULE) {
-        target_class = mrb_vm_ci_target_class(ci);
+        struct RClass *tc = mrb_vm_ci_target_class(ci);
+        if (tc) target_class = tc;
+        else target_class = mrb_class(mrb, regs[0]);
         if (target_class->tt != MRB_TT_ICLASS) {
           goto super_typeerror;
         }
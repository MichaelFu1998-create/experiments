diff --git a/src/modbus.c b/src/modbus.c
index 43e8a35..856c4fe 100644
--- a/src/modbus.c
+++ b/src/modbus.c
@@ -960,9 +960,9 @@ int modbus_reply(modbus_t *ctx, const uint8_t *req,
                 "Illegal nb of values (W%d, R%d) in write_and_read_registers (max W%d, R%d)\n",
                 nb_write, nb, MODBUS_MAX_WR_WRITE_REGISTERS, MODBUS_MAX_WR_READ_REGISTERS);
         } else if (mapping_address < 0 ||
-                   (mapping_address + nb) > mb_mapping->nb_registers ||
-                   mapping_address < 0 ||
-                   (mapping_address_write + nb_write) > mb_mapping->nb_registers) {
+                   nb > (mb_mapping->nb_registers - mapping_address) ||
+                   mapping_address_write < 0 ||
+                   nb_write > (mb_mapping->nb_registers - mapping_address_write)) {
             rsp_length = response_exception(
                 ctx, &sft, MODBUS_EXCEPTION_ILLEGAL_DATA_ADDRESS, rsp, FALSE,
                 "Illegal data read address 0x%0X or write address 0x%0X write_and_read_registers\n",